<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nawat Swatthong, Liangqi Tang, Yuanjie Xu">

<title>531 final project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#arma" id="toc-arma" class="nav-link" data-scroll-target="#arma">ARMA</a>
  <ul>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data Analysis</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  <li><a href="#choosing-arma-model" id="toc-choosing-arma-model" class="nav-link" data-scroll-target="#choosing-arma-model">Choosing ARMA model</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model Diagnostics</a></li>
  </ul></li>
  <li><a href="#seir-model" id="toc-seir-model" class="nav-link" data-scroll-target="#seir-model">SEIR Model</a>
  <ul>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description">Model Description</a></li>
  <li><a href="#model-assumption" id="toc-model-assumption" class="nav-link" data-scroll-target="#model-assumption">Model Assumption</a></li>
  <li><a href="#model-initialization" id="toc-model-initialization" class="nav-link" data-scroll-target="#model-initialization">Model Initialization</a></li>
  <li><a href="#local-search" id="toc-local-search" class="nav-link" data-scroll-target="#local-search">Local Search</a></li>
  <li><a href="#global-search" id="toc-global-search" class="nav-link" data-scroll-target="#global-search">Global Search</a>
  <ul>
  <li><a href="#based-on-local-search" id="toc-based-on-local-search" class="nav-link" data-scroll-target="#based-on-local-search">Based on Local Search</a></li>
  <li><a href="#not-based-on-local-search" id="toc-not-based-on-local-search" class="nav-link" data-scroll-target="#not-based-on-local-search">Not Based on Local Search</a></li>
  <li><a href="#profile-likelihood-on-rho" id="toc-profile-likelihood-on-rho" class="nav-link" data-scroll-target="#profile-likelihood-on-rho">Profile likelihood on <span class="math inline">\(\rho\)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">Reference</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">531 final project</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nawat Swatthong, Liangqi Tang, Yuanjie Xu </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The outbreak of COVID-19 since late 2019 has posed unprecedented challenges to global public health systems and societal well-being. Among the affected regions, Japan stands as a notable case study due to its unique socio-demographic characteristics, healthcare infrastructure, and governmental response strategies. According to JHU <a href="https://gisanddata.maps.arcgis.com/apps/dashboards/bda7594740fd40299423467b48e9ecf6">[1]</a>, by far the COVID-19 has caused total cases of 33,329,551 and total deaths of 73,046.</p>
<p>In this study, we aim to explore the temporal dynamics of COVID-19 report cases time series in Japan using a combination of two distinct yet complementary modeling approaches: Autoregressive Moving Average (ARMA <a href="https://en.wikipedia.org/wiki/Autoregressive_moving-average_model">[2]</a>) models and Susceptible-Exposed-Infectious-Recovered (SIR/SEIR <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology">[3]</a>) compartmental models.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The dataset comes from this github website <a href="https://github.com/owid/covid-19-data/tree/master/public/data">[4]</a>, whose cases and deaths are collected from World Health Organization Coronavirus Dashboard <a href="https://data.who.int/dashboards/covid19/cases?n=c">[5]</a>. This dataset is weekly based and we filtered out the data from Japan sorted by time. In the end, we got a time series of 222 observations from 2020-01-05 to 2024-03-31.</p>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the time-series</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covid_japan_week, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cases"</span>)<span class="sc">+</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Japan Covid Reports"</span>)<span class="sc">+</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"aquamarine3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The time series plot clearly illustrates three distinct outbreaks of COVID-19 cases: one in early 2022, another in mid to late 2022, and a third towards the end of the same year. It is important to note that this time series reflects a complex interplay of societal, political, and behavioral factors, which are challenging to fully incorporate into our analysis. Therefore, this study focuses solely on utilizing time series models to fit the original data and optimize numerical procedures to achieve maximum likelihood and optimal simulation outcomes. The emphasis lies on numerical accuracy rather than delving deeply into the underlying factors driving the data.</p>
</section>
<section id="arma" class="level1">
<h1>ARMA</h1>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<p>Firstly, we explore this time series with ARMA model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>covid.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="at">data=</span>covid_japan_week<span class="sc">$</span>new_cases,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">1</span>),<span class="at">frequency=</span><span class="dv">52</span>,<span class="at">names=</span><span class="fu">c</span>(<span class="st">'cases'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF and PACF</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(covid.ts, <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">main =</span> <span class="st">"ACF Plot of Covid in Japan"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(covid.ts, <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">main =</span> <span class="st">"PACF Plot of Covid in Japan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at the ACF and PACF <a href="https://ionides.github.io/531w24/02/slides.pdf">[6]</a> plot of the time series, we can observe a significant oscillation, which might suggest a periodicity pattern in it. To further investigate it, we do the spectrum analysis <a href="https://ionides.github.io/531w24/07/slides.pdf">[7]</a> below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spectrum analysis</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># smoothed periodogram</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>spectrum_s <span class="ot">&lt;-</span> <span class="fu">spectrum</span>(covid.ts, <span class="at">spans =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">4</span>), <span class="at">main =</span> <span class="st">"Smoothed periodogram"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> spectrum_s<span class="sc">$</span>freq[<span class="fu">which.max</span>(spectrum_s<span class="sc">$</span>spec)], <span class="at">lty =</span> <span class="st">"dotted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>spectrum_s<span class="sc">$</span>freq[<span class="fu">which.max</span>(spectrum_s<span class="sc">$</span>spec)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2311111</code></pre>
</div>
</div>
<p>Since the frequency is <span class="math inline">\(0.2311111\text{ week}^{-1}\)</span>, thus the period is <span class="math inline">\(4.326923\text{ week}\)</span>. This means that a seasonal pattern with the period to be a month is appropriate. Besides, from the time series there seems not to be a clear trend so we do not use integration in ARMA fitting.</p>
</section>
<section id="model-specification" class="level2">
<h2 class="anchored" data-anchor-id="model-specification">Model Specification</h2>
<p>We define the SARIMA <a href="https://ionides.github.io/531w24/06/slides.pdf">[8]</a> model equation below:</p>
<ul>
<li>Define <span class="math inline">\(Y_n\)</span> as reported cases at time <span class="math inline">\(n\)</span>.</li>
<li>Define <span class="math inline">\(\epsilon_n\)</span> as Gaussian white noise at time <span class="math inline">\(n\)</span>, i.e.&nbsp;<span class="math inline">\(\epsilon_n \overset{iid}{\sim}N(0. \sigma^2)\)</span>.</li>
<li>Define <span class="math inline">\(\mu\)</span> as the expectation value of <span class="math inline">\(Y_t\)</span>.</li>
<li>Define <span class="math inline">\(\varphi(x) = 1- \varphi_1x - \varphi_2 x^2 - \cdots - \varphi_px^p\)</span>.</li>
<li>Define <span class="math inline">\(\Phi(x) = 1- \Phi_1x - \Phi_2 x^2 - \cdots - \Phi_px^p\)</span>.</li>
<li>Define <span class="math inline">\(\psi(x) = 1+ \psi_1x + \psi_2 x^2 + \cdots + \psi_qx^q\)</span>.</li>
<li>Define <span class="math inline">\(\Psi(x) = 1+ \Psi_1x + \Psi_2 x^2 + \cdots + \Psi_qx^q\)</span>.</li>
<li>Define <span class="math inline">\(B\)</span> as the backshift operator, <span class="math inline">\(BY_n = Y_{n-1}\)</span>.</li>
</ul>
<p>Then SARIMA model equation can be represented as:</p>
<p><span class="math display">\[
\varphi(B)\Phi(B^{12})(Y_n - u) = \psi(B)\Psi(B^{12})\epsilon_{n}
\]</span></p>
</section>
<section id="choosing-arma-model" class="level2">
<h2 class="anchored" data-anchor-id="choosing-arma-model">Choosing ARMA model</h2>
<p>Now our final setting is SARIMA(p,0,q)<span class="math inline">\(\times\)</span>(1,0,1) where <span class="math inline">\(0\leq p,q \leq 5\)</span>. We calculate the AIC tables as follows:(the code is from slides 5 in class <a href="https://ionides.github.io/531w24/05/slides.pdf">[9]</a>)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC table</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>aic_table1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data,P,Q,sp,sq){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,(P<span class="sc">+</span><span class="dv">1</span>),(Q<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>P) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>Q) {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    table[p<span class="sc">+</span><span class="dv">1</span>,q<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>( {<span class="fu">Arima</span>(data, <span class="at">order=</span><span class="fu">c</span>(p,<span class="dv">0</span>,q), <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(sp,<span class="dv">0</span>,sq), <span class="at">period =</span> <span class="dv">4</span>),<span class="at">method =</span> <span class="st">"ML"</span>)<span class="sc">$</span>aic}, <span class="at">error =</span> <span class="cf">function</span>(e){<span class="fu">return</span>(<span class="cn">NA</span>)})</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(table) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">paste</span>(<span class="st">"AR"</span>,<span class="dv">0</span><span class="sc">:</span>P, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"MA"</span>,<span class="dv">0</span><span class="sc">:</span>Q,<span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  table</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>covid_aic_table <span class="ot">&lt;-</span> <span class="fu">aic_table1</span>(covid.ts,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(covid_aic_table, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"AIC of SARIMA(p,0,q),(1,0,1),  where p,q are from 0 to 5"</span>), <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>AIC of SARIMA(p,0,q),(1,0,1), where p,q are from 0 to 5</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">MA0</th>
<th style="text-align: right;">MA1</th>
<th style="text-align: right;">MA2</th>
<th style="text-align: right;">MA3</th>
<th style="text-align: right;">MA4</th>
<th style="text-align: right;">MA5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AR0</td>
<td style="text-align: right;">6075.74</td>
<td style="text-align: right;">5846.13</td>
<td style="text-align: right;">5784.56</td>
<td style="text-align: right;">5648.49</td>
<td style="text-align: right;">5628.62</td>
<td style="text-align: right;">5606.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">AR1</td>
<td style="text-align: right;">5661.20</td>
<td style="text-align: right;">5631.18</td>
<td style="text-align: right;">5611.10</td>
<td style="text-align: right;">5595.27</td>
<td style="text-align: right;">5595.67</td>
<td style="text-align: right;">5572.36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR2</td>
<td style="text-align: right;">5603.93</td>
<td style="text-align: right;">5611.29</td>
<td style="text-align: right;">5584.22</td>
<td style="text-align: right;">5581.51</td>
<td style="text-align: right;">5581.85</td>
<td style="text-align: right;">5574.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">AR3</td>
<td style="text-align: right;">5585.94</td>
<td style="text-align: right;">5589.80</td>
<td style="text-align: right;">5590.99</td>
<td style="text-align: right;">5578.80</td>
<td style="text-align: right;">5589.95</td>
<td style="text-align: right;">5574.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR4</td>
<td style="text-align: right;">5585.34</td>
<td style="text-align: right;">5584.49</td>
<td style="text-align: right;">5592.51</td>
<td style="text-align: right;">5588.73</td>
<td style="text-align: right;">5582.41</td>
<td style="text-align: right;">5568.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">AR5</td>
<td style="text-align: right;">5587.03</td>
<td style="text-align: right;">5586.25</td>
<td style="text-align: right;">5584.17</td>
<td style="text-align: right;">5571.77</td>
<td style="text-align: right;">5585.04</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To achieve lower AIC value as well as keep the model relatively simple, we finally choose the model to be SARIMA(1,0,5)<span class="math inline">\(\times\)</span>(1,0,1). Then we check the stationarity of the model and do some diagnostics.</p>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model diagnostics</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sarima_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(covid.ts, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">period=</span><span class="dv">4</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot roots</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(sarima_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check residuals</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(sarima_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,0,5)(1,0,1)[4] with non-zero mean
Q* = 54.688, df = 36, p-value = 0.02372

Model df: 8.   Total lags used: 44</code></pre>
</div>
</div>
<p>As we can see, the inverse AR and MA roots are all inside the unit circle, which means the ARMA is both stationary and causal. The Ljung-Box test and residual ACF plot show that there’s correlation between the residual in the model, which kind of violates the model assumption. However, the residual histogram shows a nearly normal distribution. Finally we show plots of how well ARMA model fits and also do some forecast.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted and prediction</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(covid_japan_week, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"cases"</span>)<span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"fitted vs. original"</span>)<span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> covid_japan_week, <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">"Original data"</span>))<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y =</span> <span class="fu">fitted</span>(sarima_model), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">"SARMA fit"</span>))<span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Legend"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(sarima_model, <span class="at">h=</span><span class="dv">10</span>), <span class="at">main =</span> <span class="st">"forecast"</span>, <span class="at">ylab =</span> <span class="st">"Cases"</span>, <span class="at">xlab =</span> <span class="st">"Date"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="seir-model" class="level1">
<h1>SEIR Model</h1>
<section id="model-description" class="level2">
<h2 class="anchored" data-anchor-id="model-description">Model Description</h2>
<p>We have chosen to implement the SEIR model to simulate the COVID-19 outbreak because it accounts for the incubation period that is known to occur with COVID-19. This model introduces an ‘E’ stage, standing for ‘exposed’, indicating that individuals go through a latency period before they can infect others. This makes the SEIR model more practical in comparison to the SIR model, which does not consider this latency period.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="/Users/nawatswatthong/Documents/STATS531/final_project/seir_flowchart.jpeg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">SEIR Model Flowchart</figcaption>
</figure>
</div>
<p>In the flowchart, each arrow represents a specific rate of transition between the stages of the SEIR model. The stages are defined as:</p>
<ul>
<li><strong>S</strong> for the susceptible group</li>
<li><strong>E</strong> for those exposed but not yet infectious</li>
<li><strong>I</strong> for the infectious individuals</li>
<li><strong>R</strong> for those who have recovered or been removed from the population.</li>
</ul>
<p>The contact rate is denoted by <span class="math inline">\(\beta\)</span>, and the rate at which susceptible individuals become exposed is given by <span class="math inline">\(\mu_{SI} = \beta I(t)\)</span>. The transition from exposed to infectious is represented by <span class="math inline">\(\mu_{EI}\)</span>, and the rate at which infectious individuals recover or are removed is <span class="math inline">\(\mu_{IR}\)</span>. The likelihood of a case being officially reported is represented by <span class="math inline">\(\rho\)</span>.</p>
<p>The calculations for the number of individuals in each compartment are as follows:</p>
<ul>
<li><span class="math inline">\(S(t) = S(0) - \Delta N_{SE}(t)\)</span></li>
<li><span class="math inline">\(E(t) = E(0) + \Delta N_{SE}(t) - \Delta N_{EI}(t)\)</span></li>
<li><span class="math inline">\(I(t) = I(0) + \Delta N_{EI}(t) - \Delta N_{IR}(t)\)</span></li>
<li><span class="math inline">\(R(t) = R(0) + \Delta N_{IR}(t)\)</span></li>
</ul>
<p>The transitions <span class="math inline">\(\Delta N_{SE}\)</span>, <span class="math inline">\(\Delta N_{EI}\)</span>, and <span class="math inline">\(\Delta N_{IR}\)</span> are modeled using binomial distributions with the respective probabilities being calculated as follows:</p>
<ul>
<li><span class="math inline">\(\Delta N_{SE} \sim \text{Binomial}(S, 1 - e^{-\beta \frac{I}{N} \Delta t})\)</span></li>
<li><span class="math inline">\(\Delta N_{EI} \sim \text{Binomial}(E, 1 - e^{-\mu_{EI} \Delta t})\)</span></li>
<li><span class="math inline">\(\Delta N_{IR} \sim \text{Binomial}(I, 1 - e^{-\mu_{IR} \Delta t})\)</span></li>
</ul>
<p>For our measurement model, we use a discretized normal distribution truncated at zero for the reported cases:</p>
<p><span class="math inline">\(\text{Cases} = \max\{\text{round}(C_n), 0\}\)</span></p>
<p>where <span class="math inline">\(C_n\)</span> is drawn from <span class="math inline">\(N(\rho H_n, (\tau H_n)^2 + \rho H_n)\)</span>, with <span class="math inline">\(H\)</span> tracking the number of individuals moving from I to R.</p>
</section>
<section id="model-assumption" class="level2">
<h2 class="anchored" data-anchor-id="model-assumption">Model Assumption</h2>
<p>To simplify the demographic factors in our model, we assume the birth rate, death rate, and population movement to be zero, thereby considering the total population <span class="math inline">\(N = S + E + I + R\)</span> as constant. Furthermore, our data, visualized in the previous section, show several outbreaks, whereas traditional SEIR models typically describe scenarios with only one peak.</p>
<p>Consequently, we introduce a time-dependent contact rate (<span class="math inline">\(\beta\)</span>) <a href="https://ionides.github.io/531w21/final_project/project15/blinded.html">[10]</a>, allowing it to vary throughout the epidemic’s course. This variation is implemented as a step function, reflecting our exploratory data analysis (EDA) findings that the contact rate changes as the epidemic progresses.</p>
<p>To reflect the dynamic nature of public behavior towards the COVID-19 virus in Japan, our model incorporates a step function for the contact rate (<span class="math inline">\(\beta\)</span>), aligned with significant events that likely influenced social interactions and mobility. These events are used as the breakpoints for the changes in <span class="math inline">\(\beta\)</span>, and each period represents a distinct phase in the epidemic’s timeline as related to these key events:</p>
<p><span class="math display">\[
\beta =
\begin{cases}
b_1, &amp; \text{01/01/2020 - 25/05/2020 (Start of the pandemic to the lifting of the state of emergency)} \\
b_2, &amp; \text{26/05/2020 - 17/02/2021 (Post-emergency period to the beginning of vaccination)} \\
b_3, &amp; \text{18/02/2021 - 23/07/2021 (Vaccination rollout to the day before the Tokyo Olympics)} \\
b_4, &amp; \text{24/07/2021 - 31/12/2021 (During and after the Tokyo Olympics)} \\
\end{cases}
\]</span></p>
<ol type="1">
<li><strong>State of Emergency Fully Lifted</strong> <a href="https://english.kyodonews.net/news/2021/04/29b154a681ba-chronology-of-major-events-related-to-coronavirus-and-japan.html">[11]</a>: On May 25, 2020, Japan fully lifted the state of emergency initially declared due to the COVID-19 pandemic. This marked a significant change in public behavior and restrictions, likely increasing social contact rates.</li>
<li><strong>First Vaccine Administered</strong> <a href="https://en.wikipedia.org/wiki/COVID-19_vaccination_in_Japan">[12]</a>: On February 17, 2021, Japan administered its first COVID-19 vaccines, introducing a new phase in the pandemic response, which may have affected public perception of risk and altered behavior patterns.</li>
<li><strong>Tokyo Olympics</strong> <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9559364/">[13]</a>: Starting July 23, 2021, the Tokyo Olympics were held, a period associated with increased international attention and domestic mobility, potentially leading to higher contact rates.</li>
</ol>
<p>Due to the emergence of the Omicron variant on Nov 30, 2021 <a href="https://www.mhlw.go.jp/stf/newpage_22507.html">[14]</a>, which has different transmission characteristics, we will only use data up to 31/12/2021 to avoid confounding the analysis with a different pattern of infection.</p>
<p>These breakpoints were chosen based on the assumption that public health directives and major societal events significantly impact the population’s contact patterns, which are crucial for modeling the spread of the virus.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pomp)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>seir_step <span class="ot">=</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">  double Beta;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">  if(intervention == 1) Beta = b1;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="st">  else if(intervention == 2) Beta = b2;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="st">  else if(intervention == 3) Beta = b3;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="st">  else Beta = b4;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_SE = rbinom(S, 1 - exp(-Beta * I / N * dt));</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_EI = rbinom(E, 1 - exp(-mu_EI * dt));</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_IR = rbinom(I, 1 - exp(-mu_IR * dt));</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">  S -= dN_SE;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="st">  E += dN_SE - dN_EI;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="st">  I += dN_EI - dN_IR;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="st">  H += dN_IR;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>seir_rinit <span class="ot">=</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="st">  S = nearbyint(eta * N);</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="st">  E = 100;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="st">  I = 200;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="st">  H = 0;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>dmeas <span class="ot">&lt;-</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="st">  double tol=1.0e-25;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="st">  double mean =rho*H;</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="st">  double sd =sqrt(pow(tau*H,2)+rho*H);</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="st">  if(new_cases&gt;0.0){</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="st">    lik=pnorm(new_cases+0.5,mean,sd,1,0)-pnorm(new_cases-0.5,mean,sd,1,0)+tol;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="st">    lik=pnorm(new_cases+0.5,mean,sd,1,0)+tol;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="st">  if(give_log) lik=log(lik);</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>rmeas <span class="ot">&lt;-</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="st">  new_cases = rnorm(rho*H, sqrt(pow(tau*H,2)+rho*H));</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="st">  if(new_cases&gt;0.0){</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="st">    new_cases=nearbyint(new_cases);</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="st">    new_cases=0.0;</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>covid_japan_week_20_21 <span class="ot">&lt;-</span> covid_japan_week <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date<span class="sc">&lt;</span><span class="st">"2021-12-31"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Time =</span> <span class="fu">row_number</span>())</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>seir_covar <span class="ot">&lt;-</span> <span class="fu">covariate_table</span>(</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> covid_japan_week_20_21<span class="sc">$</span>Time,</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">21</span>),</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">38</span>),</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">23</span>),</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">22</span>)),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="st">"t"</span>)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="ot">=</span> covid_japan_week_20_21 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Time, new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pomp</span>(</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">times =</span> <span class="st">"Time"</span>, <span class="at">t0 =</span> <span class="dv">1</span>,</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">rprocess =</span> <span class="fu">euler</span>(seir_step, <span class="at">delta.t =</span> <span class="dv">1</span>),</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">rinit =</span> seir_rinit,</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmeasure =</span> rmeas,</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">dmeasure =</span> dmeas,</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">accumvars =</span> <span class="st">"H"</span>,</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">partrans=</span><span class="fu">parameter_trans</span>(</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">log =</span> <span class="fu">c</span>(<span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>, <span class="st">"tau"</span>, <span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"b4"</span>),</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">logit =</span> <span class="fu">c</span>(<span class="st">"rho"</span>, <span class="st">"eta"</span>)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">statenames =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"I"</span>, <span class="st">"H"</span>),</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">paramnames =</span> <span class="fu">c</span>(<span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"b4"</span>, <span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>, </span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"eta"</span>, <span class="st">"rho"</span>, <span class="st">"N"</span>, <span class="st">"tau"</span>),</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">covar =</span> seir_covar</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-initialization" class="level2">
<h2 class="anchored" data-anchor-id="model-initialization">Model Initialization</h2>
<p>Japan’s population for the year 2020 was reported to be 126,226,568<a href="https://en.wikipedia.org/wiki/Demographics_of_Japan#:~:text=According%20to%20a%20demographic%20study,511%2C000%20people%20in%20one%20year.">[15]</a>. Consistent with our prior assumptions, we shall maintain <span class="math inline">\(N\)</span> as a constant value at 126,226,568. According to the Centers for Disease Control and Prevention (CDC)<a href="https://www.cdc.gov/coronavirus/2019-ncov/hcp/clinical-care/clinical-considerations-presentation.html#:~:text=Meta%2Danalyses%20of%20studies%20published,from%20exposure%20to%20symptom%20onset.">[16]</a>, the incubation period for corona viruses is at 6.5 days by average. Therefore, we anticipate that the transition rate from exposed to infectious (<span class="math inline">\(\mu_{EI}\)</span>) will be <span class="math inline">\(\frac{1}{6.5 \text{ days}} = 0.15 \text{ day}^{-1}\)</span>.</p>
<p>Recovery from COVID-19 typically takes a minimum of two weeks, with emerging research indicating that most adults with mild to moderate symptoms cease to be infectious approximately 10 days after symptoms manifest. <a href="https://archive.cdc.gov/#/details?archive_url=https://archive.cdc.gov/www_cdc_gov/coronavirus/2019-ncov/your-health/isolation.html">[17]</a> Consequently, the rate at which infectious individuals recover or are removed (<span class="math inline">\(\mu_{IR}\)</span>) is estimated to be around <span class="math inline">\(0.1 \text{ day}^{-1}\)</span>. We have decided to set both <span class="math inline">\(\mu_{EI}\)</span> and <span class="math inline">\(\mu_{IR}\)</span> at 0.1, fixing these values for both local and global searches.</p>
<p>Utilizing this information, we conducted several simulations with varied parameters. The results suggest the following set of parameters as suitable initial values for our local search:</p>
<p><span class="math display">\[
\begin{cases}
b_1 = 1, b_2 = 10, b_3 = 20, b_4 = 18 \\
\mu_{EI} = 0.1, \mu_{IR} = 0.1 \\
\rho = 0.4 \\
\eta = 0.09 \\
\tau = 0.05 \\
N = 126,226,568 \\
\end{cases}
\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">10</span>, <span class="at">b3 =</span> <span class="dv">20</span>, <span class="at">b4 =</span> <span class="dv">18</span>, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu_EI =</span> <span class="fl">0.1</span>, <span class="at">mu_IR =</span> <span class="fl">0.1</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">eta =</span> <span class="fl">0.09</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">tau =</span> <span class="fl">0.05</span>, <span class="at">N =</span> <span class="dv">126226568</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>fixed_params <span class="ot">=</span> params[<span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>)]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>params_rw.sd <span class="ot">=</span> <span class="fu">rw_sd</span>(<span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.02</span>, <span class="at">b3 =</span> <span class="fl">0.02</span>, <span class="at">b4 =</span> <span class="fl">0.02</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rho =</span> <span class="fl">0.02</span>, <span class="at">tau =</span> <span class="fl">0.0001</span>, <span class="at">eta =</span> <span class="fu">ivp</span>(<span class="fl">0.02</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">2289432</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"lik_starting_vals.rds"</span>, {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    covidSEIR <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">params=</span>params,  <span class="at">Np=</span><span class="dv">500</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> pf</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>pf <span class="sc">%&gt;%</span> <span class="fu">logLik</span>() <span class="sc">%&gt;%</span> <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         est           se 
-4219.645321     2.084666 </code></pre>
</div>
</div>
<p>we obtain an unbiased likelihood estimate of -4219.65 with a Monte Carlo standard error of 2.08.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_simulation <span class="ot">=</span> <span class="cf">function</span>(sim_dat) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  sim_dat <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, new_cases, <span class="at">group =</span> .id, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>), <span class="at">alpha =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>))) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"aquamarine3"</span>, <span class="st">"coral1"</span>)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>} <span class="co"># plot_simulation()</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(<span class="at">params =</span> params, <span class="at">nsim =</span> <span class="dv">20</span>, <span class="at">format =</span> <span class="st">"data.frame"</span>, <span class="at">include.data =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_simulation</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the initial parameters, the simulations detect the trend of the biggest peak, but still be not able to capture the other major outbreaks.</p>
</section>
<section id="local-search" class="level2">
<h2 class="anchored" data-anchor-id="local-search">Local Search</h2>
<p>we use iterative filtering to do local search for the maximum likelihood estimates (MLE), starting from the initial settings. From the trace plot we can see that the log likelihood values show improvement as the iterations progress, suggesting that the model fit to the data is improving. The convergence of lines towards the latter iterations indicates that the model is approaching an optimal solution.</p>
<p>The trends on b1, b2, b3 and rho seem to be stabilizing and show small variation as the iterations progress. However, for b4, eta and tau, there are still some variability, indicating potential uncertainty in these estimates or more iterations may be needed for convergence.</p>
<div class="cell" data-hash="final_project_cache/html/unnamed-chunk-14_219be4ad0c679a38a9c7d04cdedbe644">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">92375912</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"local_search.rds"</span>, {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">params =</span> params,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">Np =</span> <span class="dv">10000</span>, <span class="at">Nmif =</span> <span class="dv">50</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">cooling.fraction.50 =</span> <span class="fl">0.5</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">rw.sd =</span> params_rw.sd</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> mifs_local</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(mifs_local,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  mifs_local</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> mifs_local</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>mifs_local <span class="sc">%&gt;%</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">traces</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> value, <span class="at">group =</span> .L1, <span class="at">color =</span> <span class="fu">factor</span>(.L1))) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="final_project_cache/html/unnamed-chunk-15_5c0b882e3e51b21f3019ac4cf509f410">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">120242857</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"local_profile.rds"</span>, {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">mf =</span> mifs_local, <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">logLik</span>(<span class="fu">pfilter</span>(mf, <span class="at">Np =</span> <span class="dv">10000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>], <span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> results</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Local search results with the Best Likelihood Values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Local search results with the Best Likelihood Values</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">b1</th>
<th style="text-align: right;">b2</th>
<th style="text-align: right;">b3</th>
<th style="text-align: right;">b4</th>
<th style="text-align: right;">mu_EI</th>
<th style="text-align: right;">mu_IR</th>
<th style="text-align: right;">rho</th>
<th style="text-align: right;">eta</th>
<th style="text-align: right;">tau</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">loglik</th>
<th style="text-align: right;">loglik.se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">54.321</td>
<td style="text-align: right;">1766.945</td>
<td style="text-align: right;">16.463</td>
<td style="text-align: right;">29.800</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">0.139</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2205.946</td>
<td style="text-align: right;">0.032</td>
</tr>
<tr class="even">
<td style="text-align: right;">62.045</td>
<td style="text-align: right;">2175.460</td>
<td style="text-align: right;">4.302</td>
<td style="text-align: right;">7.637</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.185</td>
<td style="text-align: right;">0.131</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2299.570</td>
<td style="text-align: right;">0.950</td>
</tr>
<tr class="odd">
<td style="text-align: right;">60.369</td>
<td style="text-align: right;">181.930</td>
<td style="text-align: right;">123.445</td>
<td style="text-align: right;">23.589</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.165</td>
<td style="text-align: right;">0.119</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2308.611</td>
<td style="text-align: right;">0.025</td>
</tr>
<tr class="even">
<td style="text-align: right;">61.695</td>
<td style="text-align: right;">292.057</td>
<td style="text-align: right;">15.867</td>
<td style="text-align: right;">37.660</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">0.114</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2340.525</td>
<td style="text-align: right;">0.032</td>
</tr>
<tr class="odd">
<td style="text-align: right;">67.441</td>
<td style="text-align: right;">336.338</td>
<td style="text-align: right;">8.327</td>
<td style="text-align: right;">10.919</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.192</td>
<td style="text-align: right;">0.111</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2394.975</td>
<td style="text-align: right;">1.101</td>
</tr>
<tr class="even">
<td style="text-align: right;">68.673</td>
<td style="text-align: right;">104.798</td>
<td style="text-align: right;">7.416</td>
<td style="text-align: right;">6.860</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.196</td>
<td style="text-align: right;">0.106</td>
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">-2429.050</td>
<td style="text-align: right;">0.021</td>
</tr>
</tbody>
</table>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4 <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the result table and pair-wise scatter plot above, we can see that among the top likelihood values, the probable parameter settings are around the following:</p>
<p><span class="math display">\[
\begin{cases}
b_1 \in [50,75], b_2 \in [100,300], b_3 \in [0,25], b_4 \in [0,30]\\
\mu_{EI} = 0.1, \mu_{IR} = 0.1 \\
\rho \in [0.0,0.3], \eta \in [0.0,0.3], \tau \in [0,0.06] \\
N = 126,226,568 \\
\end{cases}
\]</span></p>
</section>
<section id="global-search" class="level2">
<h2 class="anchored" data-anchor-id="global-search">Global Search</h2>
<section id="based-on-local-search" class="level3">
<h3 class="anchored" data-anchor-id="based-on-local-search">Based on Local Search</h3>
<p>Based on the result of local search, we will perform a global search from multiple starting points, using a multi-stage iterative filtering process. Compared to normal iterative filtering process, the iteration time is longer and the disturbance amplitude is lower. We randomly draw 500 sets of starting values from the parameters that around the major trend in the trace plots in local research part that we mentioned above.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2062379496</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>guesses <span class="ot">=</span> <span class="fu">runif_design</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">50</span>, <span class="at">b2 =</span> <span class="dv">100</span>, <span class="at">b3 =</span> <span class="dv">0</span>, <span class="at">b4 =</span> <span class="dv">0</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">eta =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="dv">0</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">75</span>, <span class="at">b2 =</span> <span class="dv">300</span>, <span class="at">b3 =</span> <span class="dv">25</span>, <span class="at">b4 =</span> <span class="dv">30</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">eta =</span> <span class="fl">0.3</span>, <span class="at">tau =</span> <span class="fl">0.006</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nseq =</span> <span class="dv">500</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_1.rds"</span>,{</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoRNG</span>(<span class="dv">1270401374</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess=</span><span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span> <span class="co"># cooling.fraction.50 = 0.5</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">Nmif =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(<span class="dv">20</span>, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="ot">-&gt;</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The result table below of global search displays six groups of estimates with the maximum likelihood values. Some of the estimated parameters and likelihood are stable, and the maximum likelihood estimate (MLE) obtained a log likelihood of -3531.871 and a standard error of 0.264, which is an improvement from our initial guess.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Global search results with the Best Likelihood Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Global search results with the Best Likelihood Value</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">b1</th>
<th style="text-align: right;">b2</th>
<th style="text-align: right;">b3</th>
<th style="text-align: right;">b4</th>
<th style="text-align: right;">rho</th>
<th style="text-align: right;">eta</th>
<th style="text-align: right;">tau</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">mu_EI</th>
<th style="text-align: right;">mu_IR</th>
<th style="text-align: right;">loglik</th>
<th style="text-align: right;">loglik.se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">108.831</td>
<td style="text-align: right;">257.508</td>
<td style="text-align: right;">43.657</td>
<td style="text-align: right;">20.703</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.322</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3531.871</td>
<td style="text-align: right;">0.264</td>
</tr>
<tr class="even">
<td style="text-align: right;">122.637</td>
<td style="text-align: right;">209.407</td>
<td style="text-align: right;">24.826</td>
<td style="text-align: right;">6.642</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.315</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3592.012</td>
<td style="text-align: right;">0.012</td>
</tr>
<tr class="odd">
<td style="text-align: right;">125.731</td>
<td style="text-align: right;">84.774</td>
<td style="text-align: right;">23.704</td>
<td style="text-align: right;">11.026</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.294</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3592.979</td>
<td style="text-align: right;">0.011</td>
</tr>
<tr class="even">
<td style="text-align: right;">156.443</td>
<td style="text-align: right;">359.856</td>
<td style="text-align: right;">2.444</td>
<td style="text-align: right;">1.654</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">0.322</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3593.985</td>
<td style="text-align: right;">0.032</td>
</tr>
<tr class="odd">
<td style="text-align: right;">117.050</td>
<td style="text-align: right;">295.112</td>
<td style="text-align: right;">4.527</td>
<td style="text-align: right;">9.873</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.271</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3602.926</td>
<td style="text-align: right;">0.018</td>
</tr>
<tr class="even">
<td style="text-align: right;">126.195</td>
<td style="text-align: right;">261.989</td>
<td style="text-align: right;">5.721</td>
<td style="text-align: right;">14.805</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">0.299</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-3610.625</td>
<td style="text-align: right;">0.110</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, the simulations with the MLE are not as good as we expected. The reasons might be that the new cases number is too high. And log scale may be needed to normalized the log-likelihood. That’s why we see the better log-likelihood from this plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="ot">-&gt;</span> best_global_results</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">531</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">params=</span><span class="fu">unlist</span>(best_global_results[<span class="dv">1</span>,]),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nsim=</span><span class="dv">10</span>,<span class="at">format=</span><span class="st">"data.frame"</span>,<span class="at">include.data=</span><span class="cn">TRUE</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> sims</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>new_cases,<span class="at">group=</span>.id,<span class="at">color=</span>.id<span class="sc">==</span><span class="st">"data"</span>))<span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Simulation for Data with the Best Global Parameters Searching"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The pairs plot and simulation plot for the global search are as below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="ot">-&gt;</span> tmp</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> mu_EI <span class="sc">+</span> mu_IR <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Our local guessing and global search return distinct simulation curves, with the local search providing a more accurate estimate. Global search simulation appears to not align well with the data in terms of estimating the extent and time of the peak, but it is better at simulating the data behavior at early time.</p>
<p>Taking the accuracy of the initial guessing, next, we will perform a global search around the initial guessing. We set the range around the initial parameters to see the results of global search, which are <span class="math inline">\(b_1 \in [0,5], b_2 \in [5,15], b_3 \in [10,30], b_4 \in [10,30], \rho \in [0.2,0.6], \eta \in [0,0.2]\)</span> and <span class="math inline">\(\tau \in [0, 0.01]\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>covid_box <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b2 =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">15</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">b3 =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">b4 =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_EI =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_IR =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">126226568</span>,<span class="dv">126226568</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>cooling.fraction<span class="fl">.50</span> <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>params_rw.sd <span class="ot">&lt;-</span> <span class="fu">rw_sd</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fl">0.0001</span>, <span class="at">b2 =</span> <span class="fl">0.0001</span>, <span class="at">b3 =</span> <span class="fl">0.0005</span>, <span class="at">b4 =</span> <span class="fl">0.0005</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fl">0.0005</span>, <span class="at">eta =</span> <span class="fl">0.0001</span>, <span class="at">tau =</span> <span class="fl">0.00001</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"mifs_global.rds"</span>, {</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mif2</span>(</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>      covidSEIR,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> <span class="fu">c</span>(<span class="fu">apply</span>(covid_box, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">1</span>, x[<span class="dv">1</span>], x[<span class="dv">2</span>]))),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">Np =</span> <span class="dv">5000</span>, <span class="at">Nmif =</span> <span class="dv">50</span>,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">cooling.fraction.50 =</span> cooling.fraction<span class="fl">.50</span>,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">rw.sd =</span> params_rw.sd</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> mifs_global</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(mifs_global, <span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  mifs_global</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> mifs_global</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_results.rds"</span>, {</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">mf =</span> mifs_global, <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    evals <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">20</span>, <span class="fu">logLik</span>(<span class="fu">pfilter</span>(mf, <span class="at">Np =</span> <span class="dv">10000</span>)))</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">&lt;-</span> <span class="fu">logmeanexp</span>(evals, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    mf <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>], <span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> global_results</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(global_results, <span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  global_results</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> global_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The best global search had the following simulated parameters and log likelihood:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(global_results) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="ot">-&gt;</span> best_global_results</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(best_global_results),<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         b1       b2       b3        b4 mu_EI mu_IR         rho        eta
1 1.8014787 7.060550 15.09270 30.855048   0.1   0.1 0.090956144 0.14079801
2 3.1796404 1.430629 23.32088 17.710414   0.1   0.1 0.045386884 0.12844032
3 0.3481321 0.522957 79.11982 39.193039   0.1   0.1 0.008300037 0.06610673
4 1.1583052 9.218806 22.23219  7.185733   0.1   0.1 0.012626911 0.04911343
5 5.5194333 4.252043 14.04972 15.074907   0.1   0.1 0.285453447 0.09598037
           tau         N    loglik   loglik.se
1 0.0098946108 126226568 -4457.772 0.257008369
2 0.0097883219 126226568 -4830.151 2.010767763
3 0.0068377589 126226568 -5144.275 0.006159244
4 0.0007682026 126226568 -5420.818 0.152070041
5 0.0087750539 126226568 -5424.729 0.097870364</code></pre>
</div>
</div>
<p>The best global search has a likelihood of -4457.772 and a standard error of 0.257, which is not significantly better than the log likelihood of the previous local and global search. The pairs plot and simulation plot for the global search are as below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(global_results) <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="ot">-&gt;</span> tmp</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4, <span class="at">data =</span> global_results, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> mu_EI <span class="sc">+</span> mu_IR <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> global_results, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">531</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">params=</span><span class="fu">unlist</span>(best_global_results[<span class="dv">1</span>,]),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nsim=</span><span class="dv">10</span>,<span class="at">format=</span><span class="st">"data.frame"</span>,<span class="at">include.data=</span><span class="cn">TRUE</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> sims</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>new_cases,<span class="at">group=</span>.id,<span class="at">color=</span>.id<span class="sc">==</span><span class="st">"data"</span>))<span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Simulation for data with global parameters searching"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Although the simulation plot is more reasonable fit for our data, it still appears to miss the peak of cases, in timing and extent. Taking the log likelihood into consideration, the results of previous global search is better.</p>
</section>
<section id="not-based-on-local-search" class="level3">
<h3 class="anchored" data-anchor-id="not-based-on-local-search">Not Based on Local Search</h3>
<p>Next, we will explore on the parameter settings without using the result from local search, especially the <span class="math inline">\(\tau\)</span> parameter that we will increase the range of parameter value as the following: <span class="math display">\[
\begin{cases}
b_1, b_2, b_3, b_4 \in [0,30]\\
\mu_{EI} = 0.1, \mu_{IR} = 0.1 \\
\rho \in [0.0,0.1], \eta \in [0.0,0.3], \tau \in [0,0.2] \\
N = 126,226,568 \\
\end{cases}
\]</span></p>
<div class="cell" data-hash="final_project_cache/html/unnamed-chunk-24_e62fb68dd9ae1ecae20afe4ea7dfea8c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>NSTART <span class="ot">=</span> <span class="dv">100</span> <span class="co"># 200</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>NMIF_L <span class="ot">=</span> <span class="dv">50</span><span class="co"># 100</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>NREPS_EVAL <span class="ot">=</span> <span class="dv">10</span> <span class="co"># 20</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>NP <span class="ot">=</span> <span class="dv">1000</span> <span class="co"># 1500</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a box of starting values (for parameters)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2062379496</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>guesses <span class="ot">=</span> <span class="fu">runif_design</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">0</span>, <span class="at">b2 =</span> <span class="dv">0</span>, <span class="at">b3 =</span> <span class="dv">0</span>, <span class="at">b4 =</span> <span class="dv">0</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">eta =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="dv">0</span>),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">30</span>, <span class="at">b2 =</span> <span class="dv">30</span>, <span class="at">b3 =</span> <span class="dv">30</span>, <span class="at">b4 =</span> <span class="dv">30</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">1</span>, <span class="at">eta =</span> <span class="fl">0.3</span>, <span class="at">tau =</span> <span class="fl">0.2</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">nseq =</span> NSTART</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]] <span class="co"># take the output of previous IF process (local search)</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_2.rds"</span>,{</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoRNG</span>(<span class="dv">1270401374</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess=</span><span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span> <span class="co"># cooling.fraction.50 = 0.5</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">Nmif =</span> NMIF_L) <span class="sc">%&gt;%</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L) <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf <span class="sc">%&gt;%</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(NREPS_EVAL, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> NP) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="ot">-&gt;</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Global search results (in decreasing order of likelihood)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Global search results (in decreasing order of likelihood)</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">b1</th>
<th style="text-align: right;">b2</th>
<th style="text-align: right;">b3</th>
<th style="text-align: right;">b4</th>
<th style="text-align: right;">rho</th>
<th style="text-align: right;">eta</th>
<th style="text-align: right;">tau</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">mu_EI</th>
<th style="text-align: right;">mu_IR</th>
<th style="text-align: right;">loglik</th>
<th style="text-align: right;">loglik.se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">96.594</td>
<td style="text-align: right;">1.235</td>
<td style="text-align: right;">41.542</td>
<td style="text-align: right;">7.298</td>
<td style="text-align: right;">0.552</td>
<td style="text-align: right;">0.031</td>
<td style="text-align: right;">0.601</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1083.801</td>
<td style="text-align: right;">0.015</td>
</tr>
<tr class="even">
<td style="text-align: right;">86.755</td>
<td style="text-align: right;">0.679</td>
<td style="text-align: right;">40.186</td>
<td style="text-align: right;">666.060</td>
<td style="text-align: right;">0.465</td>
<td style="text-align: right;">0.037</td>
<td style="text-align: right;">0.501</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1085.878</td>
<td style="text-align: right;">0.014</td>
</tr>
<tr class="odd">
<td style="text-align: right;">72.405</td>
<td style="text-align: right;">0.247</td>
<td style="text-align: right;">33.745</td>
<td style="text-align: right;">351.934</td>
<td style="text-align: right;">0.366</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">0.394</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1088.543</td>
<td style="text-align: right;">0.008</td>
</tr>
<tr class="even">
<td style="text-align: right;">72.289</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">35.479</td>
<td style="text-align: right;">3042.800</td>
<td style="text-align: right;">0.357</td>
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">0.383</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1089.204</td>
<td style="text-align: right;">0.009</td>
</tr>
<tr class="odd">
<td style="text-align: right;">65.006</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: right;">30.278</td>
<td style="text-align: right;">18.577</td>
<td style="text-align: right;">0.315</td>
<td style="text-align: right;">0.059</td>
<td style="text-align: right;">0.340</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1090.342</td>
<td style="text-align: right;">0.009</td>
</tr>
<tr class="even">
<td style="text-align: right;">60.385</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">28.417</td>
<td style="text-align: right;">43.431</td>
<td style="text-align: right;">0.287</td>
<td style="text-align: right;">0.065</td>
<td style="text-align: right;">0.316</td>
<td style="text-align: right;">126226568</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">-1091.312</td>
<td style="text-align: right;">0.012</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Then we tried different setting among the best global searching results:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">60</span>, <span class="at">b2 =</span> <span class="fl">0.06</span>, <span class="at">b3 =</span> <span class="dv">40</span>, <span class="at">b4 =</span> <span class="dv">600</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu_EI =</span> <span class="fl">0.1</span>, <span class="at">mu_IR =</span> <span class="fl">0.1</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">eta =</span> <span class="fl">0.05</span>, </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">tau =</span> <span class="fl">0.3</span>, <span class="at">N =</span> <span class="dv">126226568</span>), <span class="at">nsim =</span> <span class="dv">30</span>, <span class="at">format =</span> <span class="st">"data.frame"</span>, <span class="at">include.data =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_simulation</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The simulations conducted using MLE among global search results demonstrate clear improvements over initial starting points. They effectively capture the peaks and turning points of the epidemic, with the exception of the onset of the first outbreak. Furthermore, they offer a reasonable explanation for the spread of the virus under specific conditions.</p>
<p>We then proceed to examine the likelihood surface of the parameters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(guesses) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(loglik),<span class="st">"guess"</span>,<span class="st">"result"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(type) <span class="ot">-&gt;</span> all</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>b1<span class="sc">+</span>b2<span class="sc">+</span>b3<span class="sc">+</span>b4, <span class="at">data=</span>all, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="at">col=</span><span class="fu">ifelse</span>(all<span class="sc">$</span>type<span class="sc">==</span><span class="st">"guess"</span>,<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>rho<span class="sc">+</span>eta<span class="sc">+</span>tau, <span class="at">data=</span>all, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="at">col=</span><span class="fu">ifelse</span>(all<span class="sc">$</span>type<span class="sc">==</span><span class="st">"guess"</span>,<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the scatter plot matrix, the initial starting points are depicted in grey, while the iterated filtering estimates are highlighted in red. Notably, parameters such as <span class="math inline">\(N, \mu_{EI}\)</span> and <span class="math inline">\(\mu_{IR}\)</span> remain fixed and are therefore excluded from the visual representation. For the remaining parameters, we observe that the global search commences from diverse starting points and converges towards specific regions within the parameter space. However, the initial scatter plots reveal a sub-optimal selection of initial values for b1 to b4, as evidenced by the insufficient decentralization of the grey points. Despite this, we are afforded a comprehensive view of the likelihood surfaces for all parameters. Remarkably, the ranges of parameters compatible with the data within our current model setting exhibit narrow variability. This heightened precision instills greater confidence in our maximum likelihood estimates.</p>
</section>
<section id="profile-likelihood-on-rho" class="level3">
<h3 class="anchored" data-anchor-id="profile-likelihood-on-rho">Profile likelihood on <span class="math inline">\(\rho\)</span></h3>
<p>The plot of the profile design are shown below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the box</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(range) <span class="ot">-&gt;</span> box</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># show the profile design</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">freeze</span>(<span class="at">seed=</span><span class="dv">1196696958</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">profile_design</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="at">rho=</span><span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.95</span>,<span class="at">length=</span><span class="dv">40</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="at">lower=</span>box[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"b3"</span>,<span class="st">"b4"</span>,<span class="st">"eta"</span>,<span class="st">"tau"</span>)],</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="at">upper=</span>box[<span class="dv">2</span>,<span class="fu">c</span>(<span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"b3"</span>,<span class="st">"b4"</span>,<span class="st">"eta"</span>,<span class="st">"tau"</span>)],</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="at">nprof=</span><span class="dv">5</span>, <span class="at">type=</span><span class="st">"runif"</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>)) <span class="ot">-&gt;</span> guesses</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(guesses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on it, we visualize the profile likelihood.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>rw_sd_rho_fixed <span class="ot">=</span> <span class="fu">rw_sd</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.02</span>, <span class="at">b3 =</span> <span class="fl">0.02</span>, <span class="at">b4 =</span> <span class="fl">0.02</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="fl">0.0001</span>, <span class="at">eta =</span> <span class="fu">ivp</span>(<span class="fl">0.02</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]]</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">2105684752</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_profile.rds"</span>, {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess =</span> <span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">rw.sd =</span> rw_sd_rho_fixed) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(NREPS_EVAL, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> NP) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results, <span class="st">"ncpu"</span>) <span class="ot">=</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> results_profile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>results_profile <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(loglik<span class="sc">&gt;</span><span class="fu">max</span>(loglik)<span class="sc">-</span><span class="dv">50</span>) <span class="ot">-&gt;</span> all</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>b1<span class="sc">+</span>b2<span class="sc">+</span>b3<span class="sc">+</span>b4<span class="sc">+</span>eta<span class="sc">+</span>tau<span class="sc">+</span>rho,<span class="at">data=</span>all,<span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the profile likelihood have very decentralized distribution, especially for <span class="math inline">\(\eta, \tau\)</span> and <span class="math inline">\(\rho\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>maxloglik <span class="ot">&lt;-</span> <span class="fu">max</span>(results_profile<span class="sc">$</span>loglik,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>ci.cutoff <span class="ot">&lt;-</span> maxloglik<span class="fl">-0.5</span><span class="sc">*</span><span class="fu">qchisq</span>(<span class="at">df=</span><span class="dv">1</span>,<span class="at">p=</span><span class="fl">0.95</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>results_profile <span class="sc">|&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(<span class="fu">round</span>(rho,<span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">rank</span>(<span class="sc">-</span>loglik)<span class="sc">&lt;</span><span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>rho,<span class="at">y=</span>loglik))<span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_smooth(method="loess",span=0.25)+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">color=</span><span class="st">"coral1"</span>,<span class="at">yintercept=</span>ci.cutoff)<span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lims</span>(<span class="at">y=</span>maxloglik<span class="sc">-</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="final_project_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rho_ci <span class="ot">=</span> results_profile <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik <span class="sc">&gt;</span> <span class="fu">max</span>(loglik) <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">qchisq</span>(<span class="at">df =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.95</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(rho), <span class="at">max =</span> <span class="fu">max</span>(rho))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rho_ci)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    min   max
  &lt;dbl&gt; &lt;dbl&gt;
1 0.661 0.926</code></pre>
</div>
</div>
<p>The 95% confidence interval for <span class="math inline">\(\rho\)</span> spans from 66.07% to 92.58%, indicating a relatively wide range. This is partially attributed to the limited number of data points surpassing the threshold. Furthermore, in comparison to other epidemic diseases or COVID-19 scenarios in different regions, the findings suggest a notably high reporting rate. This observation may suggest stringent disease reporting and control measures implemented in Japan <a href="https://kpmg.com/xx/en/home/insights/2021/12/flash-alert-2021-296.html">[18]</a>.</p>
</section>
</section>
</section>
<section id="reference" class="level1">
<h1>Reference</h1>
<p>[1] <a href="https://gisanddata.maps.arcgis.com/apps/dashboards/bda7594740fd40299423467b48e9ecf6">COVID-19 Dashboard by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University(JHU)</a>.</p>
<p>[2] <a href="https://en.wikipedia.org/wiki/Autoregressive_moving-average_model">ARMA</a>.</p>
<p>[3] <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology">SIR/SEIR</a>.</p>
<p>[4] <a href="https://github.com/owid/covid-19-data/tree/master/public/data">COVID-19 dataset</a>.</p>
<p>[5] <a href="https://data.who.int/dashboards/covid19/cases?n=c">World Health Organization Coronavirus Dashboard</a>.</p>
<p>[6] <a href="https://ionides.github.io/531w24/02/slides.pdf">ACF and PACF</a>.</p>
<p>[7] <a href="https://ionides.github.io/531w24/07/slides.pdf">Spectrum Analysis</a>.</p>
<p>[8] <a href="https://ionides.github.io/531w24/06/slides.pdf">Seasonality</a>.</p>
<p>[9] <a href="https://ionides.github.io/531w24/05/slides.pdf">AIC table code</a></p>
<p>[10] <a href="https://ionides.github.io/531w21/final_project/project15/blinded.html">Project 15, STATS531W21</a></p>
<p>[11] <a href="https://english.kyodonews.net/news/2021/04/29b154a681ba-chronology-of-major-events-related-to-coronavirus-and-japan.html">Chronology of major events related to coronavirus and Japan</a></p>
<p>[12] <a href="https://en.wikipedia.org/wiki/COVID-19_vaccination_in_Japan">COVID-19 vaccination in Japan</a></p>
<p>[13] <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9559364/">COVID-19 in Japan during 2020-2022: Characteristics, responses, and implications for the health care system</a></p>
<p>[14] <a href="https://www.mhlw.go.jp/stf/newpage_22507.html">First omicron variant in Japan</a></p>
<p>[15] <a href="https://en.wikipedia.org/wiki/Demographics_of_Japan#:~:text=According%20to%20a%20demographic%20study,511%2C000%20people%20in%20one%20year.">Demographics of Japan</a></p>
<p>[16] <a href="https://www.cdc.gov/coronavirus/2019-ncov/hcp/clinical-care/clinical-considerations-presentation.html#:~:text=Meta%2Danalyses%20of%20studies%20published,from%20exposure%20to%20symptom%20onset.">Incubation period for Covid-19</a></p>
<p>[17] <a href="https://archive.cdc.gov/#/details?archive_url=https://archive.cdc.gov/www_cdc_gov/coronavirus/2019-ncov/your-health/isolation.html">Isolation and Precautions for People with COVID-19</a></p>
<p>[18] <a href="https://kpmg.com/xx/en/home/insights/2021/12/flash-alert-2021-296.html">Japan – COVID-19: Re-Shutting of Borders for One Month Due to Omicron Variant</a></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb42" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "531 final project"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Nawat Swatthong, Liangqi Tang, Yuanjie Xu"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: TRUE</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: TRUE</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Code"</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: TRUE</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: TRUE</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>The outbreak of COVID-19 since late 2019 has posed unprecedented challenges to global public health systems and societal well-being. Among the affected regions, Japan stands as a notable case study due to its unique socio-demographic characteristics, healthcare infrastructure, and governmental response strategies. According to JHU [<span class="co">[</span><span class="ot">1</span><span class="co">]</span>](https://gisanddata.maps.arcgis.com/apps/dashboards/bda7594740fd40299423467b48e9ecf6), by far the COVID-19 has caused total cases of 33,329,551 and total deaths of 73,046.</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>In this study, we aim to explore the temporal dynamics of COVID-19 report cases time series in Japan using a combination of two distinct yet complementary modeling approaches: Autoregressive Moving Average (ARMA [<span class="co">[</span><span class="ot">2</span><span class="co">]</span>](https://en.wikipedia.org/wiki/Autoregressive_moving-average_model)) models and Susceptible-Exposed-Infectious-Recovered (SIR/SEIR [<span class="co">[</span><span class="ot">3</span><span class="co">]</span>](https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology)) compartmental models.</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE, include = FALSE}</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggplot2"</span>)) <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyverse"</span>)) <span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"knitr"</span>)) <span class="fu">install.packages</span>(<span class="st">"knitr"</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"forecast"</span>)) <span class="fu">install.packages</span>(<span class="st">"forecast"</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"patchwork"</span>)) <span class="fu">install.packages</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"foreach"</span>)) <span class="fu">install.packages</span>(<span class="st">"foreach"</span>)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"doParallel"</span>)) <span class="fu">install.packages</span>(<span class="st">"doParallel"</span>)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"doFuture"</span>)) <span class="fu">install.packages</span>(<span class="st">"doFuture"</span>)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"doRNG"</span>)) <span class="fu">install.packages</span>(<span class="st">"doRNG"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pomp"</span>)) <span class="fu">install.packages</span>(<span class="st">"pomp"</span>)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"doRNG"</span>)) <span class="fu">install.packages</span>(<span class="st">"doRNG"</span>)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"iterators"</span>)) <span class="fu">install.packages</span>(<span class="st">"iterators"</span>)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(forecast)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(foreach)</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(doParallel)</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoParallel</span>()</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(doRNG)</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(doFuture)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(iterators)</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoParallel</span>(<span class="dv">8</span>)</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoRNG</span>(<span class="dv">1590951</span>)</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, cache=TRUE}</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="co"># import the whole dataset</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/LiangqiTang/531-final-project/main/owid-covid-data.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out Japan and useful columns</span></span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>covid_japan <span class="ot">&lt;-</span> covid[covid<span class="sc">$</span>iso_code <span class="sc">==</span> <span class="st">"JPN"</span>, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"new_cases"</span>)]</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="co"># select the data of every week</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>covid_japan_week <span class="ot">&lt;-</span> covid_japan[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(covid_japan<span class="sc">$</span>date), <span class="dv">7</span>), ]</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>covid_japan_week<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(covid_japan_week<span class="sc">$</span>date)</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>The dataset comes from this github website [<span class="co">[</span><span class="ot">4</span><span class="co">]</span>](https://github.com/owid/covid-19-data/tree/master/public/data), whose cases and deaths are collected from World Health Organization Coronavirus Dashboard [<span class="co">[</span><span class="ot">5</span><span class="co">]</span>](https://data.who.int/dashboards/covid19/cases?n=c). This dataset is weekly based and we filtered out the data from Japan sorted by time. In the end, we got a time series of 222 observations from 2020-01-05 to 2024-03-31.</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory Data Analysis</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the time-series</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covid_japan_week, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cases"</span>)<span class="sc">+</span></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Japan Covid Reports"</span>)<span class="sc">+</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"aquamarine3"</span>)</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>The time series plot clearly illustrates three distinct outbreaks of COVID-19 cases: one in early 2022, another in mid to late 2022, and a third towards the end of the same year. It is important to note that this time series reflects a complex interplay of societal, political, and behavioral factors, which are challenging to fully incorporate into our analysis. Therefore, this study focuses solely on utilizing time series models to fit the original data and optimize numerical procedures to achieve maximum likelihood and optimal simulation outcomes. The emphasis lies on numerical accuracy rather than delving deeply into the underlying factors driving the data.</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="fu"># ARMA</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Analysis</span></span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>Firstly, we explore this time series with ARMA model.</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>covid.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="at">data=</span>covid_japan_week<span class="sc">$</span>new_cases,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">1</span>),<span class="at">frequency=</span><span class="dv">52</span>,<span class="at">names=</span><span class="fu">c</span>(<span class="st">'cases'</span>))</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF and PACF</span></span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(covid.ts, <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">main =</span> <span class="st">"ACF Plot of Covid in Japan"</span>)</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(covid.ts, <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">main =</span> <span class="st">"PACF Plot of Covid in Japan"</span>)</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>Looking at the ACF and PACF [<span class="co">[</span><span class="ot">6</span><span class="co">]</span>](https://ionides.github.io/531w24/02/slides.pdf) plot of the time series, we can observe a significant oscillation, which might suggest a periodicity pattern in it. To further investigate it, we do the spectrum analysis [<span class="co">[</span><span class="ot">7</span><span class="co">]</span>](https://ionides.github.io/531w24/07/slides.pdf) below:</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a><span class="co"># spectrum analysis</span></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a><span class="co"># smoothed periodogram</span></span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>spectrum_s <span class="ot">&lt;-</span> <span class="fu">spectrum</span>(covid.ts, <span class="at">spans =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">4</span>), <span class="at">main =</span> <span class="st">"Smoothed periodogram"</span>)</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> spectrum_s<span class="sc">$</span>freq[<span class="fu">which.max</span>(spectrum_s<span class="sc">$</span>spec)], <span class="at">lty =</span> <span class="st">"dotted"</span>)</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>spectrum_s<span class="sc">$</span>freq[<span class="fu">which.max</span>(spectrum_s<span class="sc">$</span>spec)]</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>Since the frequency is $0.2311111\text{ week}^{-1}$, thus the period is $4.326923\text{ week}$. This means that a seasonal pattern with the period to be a month is appropriate. Besides, from the time series there seems not to be a clear trend so we do not use integration in ARMA fitting. </span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Specification</span></span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>We define the SARIMA [<span class="co">[</span><span class="ot">8</span><span class="co">]</span>](https://ionides.github.io/531w24/06/slides.pdf) model equation below:</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $Y_n$ as reported cases at time $n$.</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\epsilon_n$ as Gaussian white noise at time $n$, i.e. $\epsilon_n \overset{iid}{\sim}N(0. \sigma^2)$.</span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\mu$ as the expectation value of $Y_t$.</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\varphi(x) = 1- \varphi_1x - \varphi_2 x^2 - \cdots - \varphi_px^p$.</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\Phi(x) = 1- \Phi_1x - \Phi_2 x^2 - \cdots - \Phi_px^p$.</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\psi(x) = 1+ \psi_1x + \psi_2 x^2 + \cdots + \psi_qx^q$.</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $\Psi(x) = 1+ \Psi_1x + \Psi_2 x^2 + \cdots + \Psi_qx^q$.</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define $B$ as the backshift operator, $BY_n = Y_{n-1}$.</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>Then SARIMA model equation can be represented as: </span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>\varphi(B)\Phi(B^{12})(Y_n - u) = \psi(B)\Psi(B^{12})\epsilon_{n}</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a><span class="fu">## Choosing ARMA model</span></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>Now our final setting is SARIMA(p,0,q)$\times$(1,0,1) where $0\leq p,q \leq 5$. We calculate the AIC tables as follows:(the code is from slides 5 in class [<span class="co">[</span><span class="ot">9</span><span class="co">]</span>](https://ionides.github.io/531w24/05/slides.pdf))</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,warning = FALSE, message = FALSE}</span></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC table</span></span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>aic_table1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data,P,Q,sp,sq){</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>  table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,(P<span class="sc">+</span><span class="dv">1</span>),(Q<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>P) {</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>Q) {</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>    table[p<span class="sc">+</span><span class="dv">1</span>,q<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>( {<span class="fu">Arima</span>(data, <span class="at">order=</span><span class="fu">c</span>(p,<span class="dv">0</span>,q), <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(sp,<span class="dv">0</span>,sq), <span class="at">period =</span> <span class="dv">4</span>),<span class="at">method =</span> <span class="st">"ML"</span>)<span class="sc">$</span>aic}, <span class="at">error =</span> <span class="cf">function</span>(e){<span class="fu">return</span>(<span class="cn">NA</span>)})</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(table) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">paste</span>(<span class="st">"AR"</span>,<span class="dv">0</span><span class="sc">:</span>P, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"MA"</span>,<span class="dv">0</span><span class="sc">:</span>Q,<span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>  table</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>covid_aic_table <span class="ot">&lt;-</span> <span class="fu">aic_table1</span>(covid.ts,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(covid_aic_table, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"AIC of SARIMA(p,0,q),(1,0,1),  where p,q are from 0 to 5"</span>), <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>To achieve lower AIC value as well as keep the model relatively simple, we finally choose the model to be SARIMA(1,0,5)$\times$(1,0,1). Then we check the stationarity of the model and do some diagnostics.</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Diagnostics</span></span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a><span class="co"># model diagnostics</span></span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>sarima_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(covid.ts, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">period=</span><span class="dv">4</span>))</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a><span class="co"># plot roots</span></span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(sarima_model)</span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a><span class="co"># check residuals</span></span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(sarima_model)</span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>As we can see, the inverse AR and MA roots are all inside the unit circle, which means the ARMA is both stationary and causal. The Ljung-Box test and residual ACF plot show that there's correlation between the residual in the model, which kind of violates the model assumption. However, the residual histogram shows a nearly normal distribution. Finally we show plots of how well ARMA model fits and also do some forecast.</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted and prediction</span></span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted</span></span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(covid_japan_week, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"cases"</span>)<span class="sc">+</span></span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"fitted vs. original"</span>)<span class="sc">+</span></span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> covid_japan_week, <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">"Original data"</span>))<span class="sc">+</span></span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y =</span> <span class="fu">fitted</span>(sarima_model), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">"SARMA fit"</span>))<span class="sc">+</span></span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Legend"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast</span></span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(sarima_model, <span class="at">h=</span><span class="dv">10</span>), <span class="at">main =</span> <span class="st">"forecast"</span>, <span class="at">ylab =</span> <span class="st">"Cases"</span>, <span class="at">xlab =</span> <span class="st">"Date"</span>)</span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a><span class="fu"># SEIR Model</span></span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Description</span></span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a>We have chosen to implement the SEIR model to simulate the COVID-19 outbreak because it accounts for the incubation period that is known to occur with COVID-19. This model introduces an 'E' stage, standing for 'exposed', indicating that individuals go through a latency period before they can infect others. This makes the SEIR model more practical in comparison to the SIR model, which does not consider this latency period.</span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a><span class="al">![SEIR Model Flowchart](/Users/nawatswatthong/Documents/STATS531/final_project/seir_flowchart.jpeg)</span></span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>In the flowchart, each arrow represents a specific rate of transition between the stages of the SEIR model. The stages are defined as: </span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**S** for the susceptible group</span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**E** for those exposed but not yet infectious</span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**I** for the infectious individuals</span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**R** for those who have recovered or been removed from the population. </span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a>The contact rate is denoted by $\beta$, and the rate at which susceptible individuals become exposed is given by $\mu_{SI} = \beta I(t)$. The transition from exposed to infectious is represented by $\mu_{EI}$, and the rate at which infectious individuals recover or are removed is $\mu_{IR}$. The likelihood of a case being officially reported is represented by $\rho$.</span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a>The calculations for the number of individuals in each compartment are as follows:</span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$S(t) = S(0) - \Delta N_{SE}(t)$</span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$E(t) = E(0) + \Delta N_{SE}(t) - \Delta N_{EI}(t)$</span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$I(t) = I(0) + \Delta N_{EI}(t) - \Delta N_{IR}(t)$</span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$R(t) = R(0) + \Delta N_{IR}(t)$</span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a>The transitions $\Delta N_{SE}$, $\Delta N_{EI}$, and $\Delta N_{IR}$ are modeled using binomial distributions with the respective probabilities being calculated as follows:</span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-227"><a href="#cb42-227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\Delta N_{SE} \sim \text{Binomial}(S, 1 - e^{-\beta \frac{I}{N} \Delta t})$</span>
<span id="cb42-228"><a href="#cb42-228" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\Delta N_{EI} \sim \text{Binomial}(E, 1 - e^{-\mu_{EI} \Delta t})$</span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\Delta N_{IR} \sim \text{Binomial}(I, 1 - e^{-\mu_{IR} \Delta t})$</span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a>For our measurement model, we use a discretized normal distribution truncated at zero for the reported cases:</span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-233"><a href="#cb42-233" aria-hidden="true" tabindex="-1"></a>$\text{Cases} = \max<span class="sc">\{</span>\text{round}(C_n), 0<span class="sc">\}</span>$</span>
<span id="cb42-234"><a href="#cb42-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a>where $C_n$ is drawn from $N(\rho H_n, (\tau H_n)^2 + \rho H_n)$, with $H$ tracking the number of individuals moving from I to R.</span>
<span id="cb42-236"><a href="#cb42-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-237"><a href="#cb42-237" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Assumption</span></span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a>To simplify the demographic factors in our model, we assume the birth rate, death rate, and population movement to be zero, thereby considering the total population $N = S + E + I + R$ as constant. Furthermore, our data, visualized in the previous section, show several outbreaks, whereas traditional SEIR models typically describe scenarios with only one peak.</span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a>Consequently, we introduce a time-dependent contact rate ($\beta$) [<span class="co">[</span><span class="ot">10</span><span class="co">]</span>](https://ionides.github.io/531w21/final_project/project15/blinded.html), allowing it to vary throughout the epidemic's course. This variation is implemented as a step function, reflecting our exploratory data analysis (EDA) findings that the contact rate changes as the epidemic progresses. </span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>To reflect the dynamic nature of public behavior towards the COVID-19 virus in Japan, our model incorporates a step function for the contact rate ($\beta$), aligned with significant events that likely influenced social interactions and mobility. These events are used as the breakpoints for the changes in $\beta$, and each period represents a distinct phase in the epidemic's timeline as related to these key events:</span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a>\beta = </span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>b_1, &amp; \text{01/01/2020 - 25/05/2020 (Start of the pandemic to the lifting of the state of emergency)} <span class="sc">\\</span></span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>b_2, &amp; \text{26/05/2020 - 17/02/2021 (Post-emergency period to the beginning of vaccination)} <span class="sc">\\</span></span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a>b_3, &amp; \text{18/02/2021 - 23/07/2021 (Vaccination rollout to the day before the Tokyo Olympics)} <span class="sc">\\</span></span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a>b_4, &amp; \text{24/07/2021 - 31/12/2021 (During and after the Tokyo Olympics)} <span class="sc">\\</span></span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**State of Emergency Fully Lifted** [<span class="co">[</span><span class="ot">11</span><span class="co">]</span>](https://english.kyodonews.net/news/2021/04/29b154a681ba-chronology-of-major-events-related-to-coronavirus-and-japan.html): On May 25, 2020, Japan fully lifted the state of emergency initially declared due to the COVID-19 pandemic. This marked a significant change in public behavior and restrictions, likely increasing social contact rates.</span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**First Vaccine Administered** [<span class="co">[</span><span class="ot">12</span><span class="co">]</span>](https://en.wikipedia.org/wiki/COVID-19_vaccination_in_Japan): On February 17, 2021, Japan administered its first COVID-19 vaccines, introducing a new phase in the pandemic response, which may have affected public perception of risk and altered behavior patterns.</span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Tokyo Olympics** [<span class="co">[</span><span class="ot">13</span><span class="co">]</span>](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9559364/): Starting July 23, 2021, the Tokyo Olympics were held, a period associated with increased international attention and domestic mobility, potentially leading to higher contact rates.</span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a>Due to the emergence of the Omicron variant on Nov 30, 2021 [<span class="co">[</span><span class="ot">14</span><span class="co">]</span>](https://www.mhlw.go.jp/stf/newpage_22507.html), which has different transmission characteristics, we will only use data up to 31/12/2021 to avoid confounding the analysis with a different pattern of infection.</span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a>These breakpoints were chosen based on the assumption that public health directives and major societal events significantly impact the population's contact patterns, which are crucial for modeling the spread of the virus.</span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pomp)</span>
<span id="cb42-266"><a href="#cb42-266" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb42-267"><a href="#cb42-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a>seir_step <span class="ot">=</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a><span class="st">  double Beta;</span></span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a><span class="st">  if(intervention == 1) Beta = b1;</span></span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a><span class="st">  else if(intervention == 2) Beta = b2;</span></span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a><span class="st">  else if(intervention == 3) Beta = b3;</span></span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a><span class="st">  else Beta = b4;</span></span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_SE = rbinom(S, 1 - exp(-Beta * I / N * dt));</span></span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_EI = rbinom(E, 1 - exp(-mu_EI * dt));</span></span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a><span class="st">  double dN_IR = rbinom(I, 1 - exp(-mu_IR * dt));</span></span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a><span class="st">  S -= dN_SE;</span></span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a><span class="st">  E += dN_SE - dN_EI;</span></span>
<span id="cb42-280"><a href="#cb42-280" aria-hidden="true" tabindex="-1"></a><span class="st">  I += dN_EI - dN_IR;</span></span>
<span id="cb42-281"><a href="#cb42-281" aria-hidden="true" tabindex="-1"></a><span class="st">  H += dN_IR;</span></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-284"><a href="#cb42-284" aria-hidden="true" tabindex="-1"></a>seir_rinit <span class="ot">=</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb42-285"><a href="#cb42-285" aria-hidden="true" tabindex="-1"></a><span class="st">  S = nearbyint(eta * N);</span></span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a><span class="st">  E = 100;</span></span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a><span class="st">  I = 200;</span></span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a><span class="st">  H = 0;</span></span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a>dmeas <span class="ot">&lt;-</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb42-292"><a href="#cb42-292" aria-hidden="true" tabindex="-1"></a><span class="st">  double tol=1.0e-25;</span></span>
<span id="cb42-293"><a href="#cb42-293" aria-hidden="true" tabindex="-1"></a><span class="st">  double mean =rho*H;</span></span>
<span id="cb42-294"><a href="#cb42-294" aria-hidden="true" tabindex="-1"></a><span class="st">  double sd =sqrt(pow(tau*H,2)+rho*H);</span></span>
<span id="cb42-295"><a href="#cb42-295" aria-hidden="true" tabindex="-1"></a><span class="st">  if(new_cases&gt;0.0){</span></span>
<span id="cb42-296"><a href="#cb42-296" aria-hidden="true" tabindex="-1"></a><span class="st">    lik=pnorm(new_cases+0.5,mean,sd,1,0)-pnorm(new_cases-0.5,mean,sd,1,0)+tol;</span></span>
<span id="cb42-297"><a href="#cb42-297" aria-hidden="true" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb42-298"><a href="#cb42-298" aria-hidden="true" tabindex="-1"></a><span class="st">    lik=pnorm(new_cases+0.5,mean,sd,1,0)+tol;</span></span>
<span id="cb42-299"><a href="#cb42-299" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb42-300"><a href="#cb42-300" aria-hidden="true" tabindex="-1"></a><span class="st">  if(give_log) lik=log(lik);</span></span>
<span id="cb42-301"><a href="#cb42-301" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb42-302"><a href="#cb42-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-303"><a href="#cb42-303" aria-hidden="true" tabindex="-1"></a>rmeas <span class="ot">&lt;-</span> <span class="fu">Csnippet</span>(<span class="st">"</span></span>
<span id="cb42-304"><a href="#cb42-304" aria-hidden="true" tabindex="-1"></a><span class="st">  new_cases = rnorm(rho*H, sqrt(pow(tau*H,2)+rho*H));</span></span>
<span id="cb42-305"><a href="#cb42-305" aria-hidden="true" tabindex="-1"></a><span class="st">  if(new_cases&gt;0.0){</span></span>
<span id="cb42-306"><a href="#cb42-306" aria-hidden="true" tabindex="-1"></a><span class="st">    new_cases=nearbyint(new_cases);</span></span>
<span id="cb42-307"><a href="#cb42-307" aria-hidden="true" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb42-308"><a href="#cb42-308" aria-hidden="true" tabindex="-1"></a><span class="st">    new_cases=0.0;</span></span>
<span id="cb42-309"><a href="#cb42-309" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb42-310"><a href="#cb42-310" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb42-311"><a href="#cb42-311" aria-hidden="true" tabindex="-1"></a>covid_japan_week_20_21 <span class="ot">&lt;-</span> covid_japan_week <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date<span class="sc">&lt;</span><span class="st">"2021-12-31"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Time =</span> <span class="fu">row_number</span>())</span>
<span id="cb42-312"><a href="#cb42-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-313"><a href="#cb42-313" aria-hidden="true" tabindex="-1"></a>seir_covar <span class="ot">&lt;-</span> <span class="fu">covariate_table</span>(</span>
<span id="cb42-314"><a href="#cb42-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> covid_japan_week_20_21<span class="sc">$</span>Time,</span>
<span id="cb42-315"><a href="#cb42-315" aria-hidden="true" tabindex="-1"></a>  <span class="at">intervention =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">21</span>),</span>
<span id="cb42-316"><a href="#cb42-316" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">38</span>),</span>
<span id="cb42-317"><a href="#cb42-317" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">23</span>),</span>
<span id="cb42-318"><a href="#cb42-318" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">22</span>)),</span>
<span id="cb42-319"><a href="#cb42-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="st">"t"</span>)</span>
<span id="cb42-320"><a href="#cb42-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-321"><a href="#cb42-321" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="ot">=</span> covid_japan_week_20_21 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Time, new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb42-322"><a href="#cb42-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pomp</span>(</span>
<span id="cb42-323"><a href="#cb42-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">times =</span> <span class="st">"Time"</span>, <span class="at">t0 =</span> <span class="dv">1</span>,</span>
<span id="cb42-324"><a href="#cb42-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">rprocess =</span> <span class="fu">euler</span>(seir_step, <span class="at">delta.t =</span> <span class="dv">1</span>),</span>
<span id="cb42-325"><a href="#cb42-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">rinit =</span> seir_rinit,</span>
<span id="cb42-326"><a href="#cb42-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmeasure =</span> rmeas,</span>
<span id="cb42-327"><a href="#cb42-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">dmeasure =</span> dmeas,</span>
<span id="cb42-328"><a href="#cb42-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">accumvars =</span> <span class="st">"H"</span>,</span>
<span id="cb42-329"><a href="#cb42-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">partrans=</span><span class="fu">parameter_trans</span>(</span>
<span id="cb42-330"><a href="#cb42-330" aria-hidden="true" tabindex="-1"></a>      <span class="at">log =</span> <span class="fu">c</span>(<span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>, <span class="st">"tau"</span>, <span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"b4"</span>),</span>
<span id="cb42-331"><a href="#cb42-331" aria-hidden="true" tabindex="-1"></a>      <span class="at">logit =</span> <span class="fu">c</span>(<span class="st">"rho"</span>, <span class="st">"eta"</span>)</span>
<span id="cb42-332"><a href="#cb42-332" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-333"><a href="#cb42-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">statenames =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"I"</span>, <span class="st">"H"</span>),</span>
<span id="cb42-334"><a href="#cb42-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">paramnames =</span> <span class="fu">c</span>(<span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"b4"</span>, <span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>, </span>
<span id="cb42-335"><a href="#cb42-335" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"eta"</span>, <span class="st">"rho"</span>, <span class="st">"N"</span>, <span class="st">"tau"</span>),</span>
<span id="cb42-336"><a href="#cb42-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">covar =</span> seir_covar</span>
<span id="cb42-337"><a href="#cb42-337" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-338"><a href="#cb42-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-339"><a href="#cb42-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-340"><a href="#cb42-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Initialization</span></span>
<span id="cb42-341"><a href="#cb42-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-342"><a href="#cb42-342" aria-hidden="true" tabindex="-1"></a>Japan's population for the year 2020 was reported to be 126,226,568[<span class="co">[</span><span class="ot">15</span><span class="co">]</span>](https://en.wikipedia.org/wiki/Demographics_of_Japan#:~:text=According%20to%20a%20demographic%20study,511%2C000%20people%20in%20one%20year.). Consistent with our prior assumptions, we shall maintain $N$ as a constant value at 126,226,568. According to the Centers for Disease Control and Prevention (CDC)[<span class="co">[</span><span class="ot">16</span><span class="co">]</span>](https://www.cdc.gov/coronavirus/2019-ncov/hcp/clinical-care/clinical-considerations-presentation.html#:~:text=Meta%2Danalyses%20of%20studies%20published,from%20exposure%20to%20symptom%20onset.), the incubation period for corona viruses is at 6.5 days by average. Therefore, we anticipate that the transition rate from exposed to infectious ($\mu_{EI}$) will be $\frac{1}{6.5 \text{ days}} = 0.15 \text{ day}^{-1}$.</span>
<span id="cb42-343"><a href="#cb42-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-344"><a href="#cb42-344" aria-hidden="true" tabindex="-1"></a>Recovery from COVID-19 typically takes a minimum of two weeks, with emerging research indicating that most adults with mild to moderate symptoms cease to be infectious approximately 10 days after symptoms manifest. [<span class="co">[</span><span class="ot">17</span><span class="co">]</span>](https://archive.cdc.gov/#/details?archive_url=https://archive.cdc.gov/www_cdc_gov/coronavirus/2019-ncov/your-health/isolation.html) Consequently, the rate at which infectious individuals recover or are removed ($\mu_{IR}$) is estimated to be around $0.1 \text{ day}^{-1}$. We have decided to set both $\mu_{EI}$ and $\mu_{IR}$ at 0.1, fixing these values for both local and global searches. </span>
<span id="cb42-345"><a href="#cb42-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-346"><a href="#cb42-346" aria-hidden="true" tabindex="-1"></a>Utilizing this information, we conducted several simulations with varied parameters. The results suggest the following set of parameters as suitable initial values for our local search:</span>
<span id="cb42-347"><a href="#cb42-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-348"><a href="#cb42-348" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-349"><a href="#cb42-349" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb42-350"><a href="#cb42-350" aria-hidden="true" tabindex="-1"></a>b_1 = 1, b_2 = 10, b_3 = 20, b_4 = 18 <span class="sc">\\</span></span>
<span id="cb42-351"><a href="#cb42-351" aria-hidden="true" tabindex="-1"></a>\mu_{EI} = 0.1, \mu_{IR} = 0.1 <span class="sc">\\</span></span>
<span id="cb42-352"><a href="#cb42-352" aria-hidden="true" tabindex="-1"></a>\rho = 0.4 <span class="sc">\\</span></span>
<span id="cb42-353"><a href="#cb42-353" aria-hidden="true" tabindex="-1"></a>\eta = 0.09 <span class="sc">\\</span></span>
<span id="cb42-354"><a href="#cb42-354" aria-hidden="true" tabindex="-1"></a>\tau = 0.05 <span class="sc">\\</span></span>
<span id="cb42-355"><a href="#cb42-355" aria-hidden="true" tabindex="-1"></a>N = 126,226,568 <span class="sc">\\</span></span>
<span id="cb42-356"><a href="#cb42-356" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb42-357"><a href="#cb42-357" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-358"><a href="#cb42-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-361"><a href="#cb42-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-362"><a href="#cb42-362" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">10</span>, <span class="at">b3 =</span> <span class="dv">20</span>, <span class="at">b4 =</span> <span class="dv">18</span>, </span>
<span id="cb42-363"><a href="#cb42-363" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu_EI =</span> <span class="fl">0.1</span>, <span class="at">mu_IR =</span> <span class="fl">0.1</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">eta =</span> <span class="fl">0.09</span>, </span>
<span id="cb42-364"><a href="#cb42-364" aria-hidden="true" tabindex="-1"></a>            <span class="at">tau =</span> <span class="fl">0.05</span>, <span class="at">N =</span> <span class="dv">126226568</span>)</span>
<span id="cb42-365"><a href="#cb42-365" aria-hidden="true" tabindex="-1"></a>fixed_params <span class="ot">=</span> params[<span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"mu_EI"</span>, <span class="st">"mu_IR"</span>)]</span>
<span id="cb42-366"><a href="#cb42-366" aria-hidden="true" tabindex="-1"></a>params_rw.sd <span class="ot">=</span> <span class="fu">rw_sd</span>(<span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.02</span>, <span class="at">b3 =</span> <span class="fl">0.02</span>, <span class="at">b4 =</span> <span class="fl">0.02</span>, </span>
<span id="cb42-367"><a href="#cb42-367" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rho =</span> <span class="fl">0.02</span>, <span class="at">tau =</span> <span class="fl">0.0001</span>, <span class="at">eta =</span> <span class="fu">ivp</span>(<span class="fl">0.02</span>))</span>
<span id="cb42-368"><a href="#cb42-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-369"><a href="#cb42-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-372"><a href="#cb42-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-373"><a href="#cb42-373" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">2289432</span>)</span>
<span id="cb42-374"><a href="#cb42-374" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"lik_starting_vals.rds"</span>, {</span>
<span id="cb42-375"><a href="#cb42-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb42-376"><a href="#cb42-376" aria-hidden="true" tabindex="-1"></a>    covidSEIR <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">params=</span>params,  <span class="at">Np=</span><span class="dv">500</span>)</span>
<span id="cb42-377"><a href="#cb42-377" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-378"><a href="#cb42-378" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> pf</span>
<span id="cb42-379"><a href="#cb42-379" aria-hidden="true" tabindex="-1"></a>pf <span class="sc">%&gt;%</span> <span class="fu">logLik</span>() <span class="sc">%&gt;%</span> <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-380"><a href="#cb42-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-381"><a href="#cb42-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-382"><a href="#cb42-382" aria-hidden="true" tabindex="-1"></a>we obtain an unbiased likelihood estimate of -4219.65 with a Monte Carlo standard error of 2.08.</span>
<span id="cb42-383"><a href="#cb42-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-384"><a href="#cb42-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb42-385"><a href="#cb42-385" aria-hidden="true" tabindex="-1"></a>plot_simulation <span class="ot">=</span> <span class="cf">function</span>(sim_dat) {</span>
<span id="cb42-386"><a href="#cb42-386" aria-hidden="true" tabindex="-1"></a>  sim_dat <span class="sc">%&gt;%</span></span>
<span id="cb42-387"><a href="#cb42-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-388"><a href="#cb42-388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-389"><a href="#cb42-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, new_cases, <span class="at">group =</span> .id, </span>
<span id="cb42-390"><a href="#cb42-390" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>), <span class="at">alpha =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>), </span>
<span id="cb42-391"><a href="#cb42-391" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> (.id <span class="sc">==</span> <span class="st">"data"</span>))) <span class="sc">+</span></span>
<span id="cb42-392"><a href="#cb42-392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"aquamarine3"</span>, <span class="st">"coral1"</span>)) <span class="sc">+</span></span>
<span id="cb42-393"><a href="#cb42-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb42-394"><a href="#cb42-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb42-395"><a href="#cb42-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-396"><a href="#cb42-396" aria-hidden="true" tabindex="-1"></a>} <span class="co"># plot_simulation()</span></span>
<span id="cb42-397"><a href="#cb42-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-398"><a href="#cb42-398" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb42-399"><a href="#cb42-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(<span class="at">params =</span> params, <span class="at">nsim =</span> <span class="dv">20</span>, <span class="at">format =</span> <span class="st">"data.frame"</span>, <span class="at">include.data =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-400"><a href="#cb42-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_simulation</span>()</span>
<span id="cb42-401"><a href="#cb42-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-402"><a href="#cb42-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-403"><a href="#cb42-403" aria-hidden="true" tabindex="-1"></a>Based on the initial parameters, the simulations detect the trend of the biggest peak, but still be not able to capture the other major outbreaks.</span>
<span id="cb42-404"><a href="#cb42-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-405"><a href="#cb42-405" aria-hidden="true" tabindex="-1"></a><span class="fu">## Local Search</span></span>
<span id="cb42-406"><a href="#cb42-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-407"><a href="#cb42-407" aria-hidden="true" tabindex="-1"></a>we use iterative filtering to do local search for the maximum likelihood estimates (MLE), starting from the initial settings. From the trace plot we can see that the log likelihood values show improvement as the iterations progress, suggesting that the model fit to the data is improving. The convergence of lines towards the latter iterations indicates that the model is approaching an optimal solution.</span>
<span id="cb42-408"><a href="#cb42-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-409"><a href="#cb42-409" aria-hidden="true" tabindex="-1"></a>The trends on b1, b2, b3 and rho seem to be stabilizing and show small variation as the iterations progress. However, for b4, eta and tau, there are still some variability, indicating potential uncertainty in these estimates or more iterations may be needed for convergence.</span>
<span id="cb42-410"><a href="#cb42-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-411"><a href="#cb42-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=TRUE}</span></span>
<span id="cb42-412"><a href="#cb42-412" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb42-413"><a href="#cb42-413" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">92375912</span>)</span>
<span id="cb42-414"><a href="#cb42-414" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"local_search.rds"</span>, {</span>
<span id="cb42-415"><a href="#cb42-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb42-416"><a href="#cb42-416" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-417"><a href="#cb42-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-418"><a href="#cb42-418" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-419"><a href="#cb42-419" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-420"><a href="#cb42-420" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-421"><a href="#cb42-421" aria-hidden="true" tabindex="-1"></a>    covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb42-422"><a href="#cb42-422" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(</span>
<span id="cb42-423"><a href="#cb42-423" aria-hidden="true" tabindex="-1"></a>        <span class="at">params =</span> params,</span>
<span id="cb42-424"><a href="#cb42-424" aria-hidden="true" tabindex="-1"></a>        <span class="at">Np =</span> <span class="dv">10000</span>, <span class="at">Nmif =</span> <span class="dv">50</span>,</span>
<span id="cb42-425"><a href="#cb42-425" aria-hidden="true" tabindex="-1"></a>        <span class="at">cooling.fraction.50 =</span> <span class="fl">0.5</span>,</span>
<span id="cb42-426"><a href="#cb42-426" aria-hidden="true" tabindex="-1"></a>        <span class="at">rw.sd =</span> params_rw.sd</span>
<span id="cb42-427"><a href="#cb42-427" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-428"><a href="#cb42-428" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> mifs_local</span>
<span id="cb42-429"><a href="#cb42-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(mifs_local,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-430"><a href="#cb42-430" aria-hidden="true" tabindex="-1"></a>  mifs_local</span>
<span id="cb42-431"><a href="#cb42-431" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> mifs_local</span>
<span id="cb42-432"><a href="#cb42-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-433"><a href="#cb42-433" aria-hidden="true" tabindex="-1"></a>mifs_local <span class="sc">%&gt;%</span></span>
<span id="cb42-434"><a href="#cb42-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">traces</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-435"><a href="#cb42-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-436"><a href="#cb42-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> value, <span class="at">group =</span> .L1, <span class="at">color =</span> <span class="fu">factor</span>(.L1))) <span class="sc">+</span></span>
<span id="cb42-437"><a href="#cb42-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-438"><a href="#cb42-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb42-439"><a href="#cb42-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb42-440"><a href="#cb42-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span>
<span id="cb42-441"><a href="#cb42-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-442"><a href="#cb42-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-443"><a href="#cb42-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=TRUE}</span></span>
<span id="cb42-444"><a href="#cb42-444" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">120242857</span>)</span>
<span id="cb42-445"><a href="#cb42-445" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"local_profile.rds"</span>, {</span>
<span id="cb42-446"><a href="#cb42-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">mf =</span> mifs_local, <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb42-447"><a href="#cb42-447" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-448"><a href="#cb42-448" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-449"><a href="#cb42-449" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-450"><a href="#cb42-450" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-451"><a href="#cb42-451" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">logLik</span>(<span class="fu">pfilter</span>(mf, <span class="at">Np =</span> <span class="dv">10000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb42-452"><a href="#cb42-452" aria-hidden="true" tabindex="-1"></a>         <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-453"><a href="#cb42-453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>], <span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb42-454"><a href="#cb42-454" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb42-455"><a href="#cb42-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-456"><a href="#cb42-456" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb42-457"><a href="#cb42-457" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> results</span>
<span id="cb42-458"><a href="#cb42-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-459"><a href="#cb42-459" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> </span>
<span id="cb42-460"><a href="#cb42-460" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Local search results with the Best Likelihood Values"</span>)</span>
<span id="cb42-461"><a href="#cb42-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-462"><a href="#cb42-462" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4 <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb42-463"><a href="#cb42-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-464"><a href="#cb42-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-465"><a href="#cb42-465" aria-hidden="true" tabindex="-1"></a>From the result table and pair-wise scatter plot above, we can see that among the top likelihood values, the probable parameter settings are around the following:</span>
<span id="cb42-466"><a href="#cb42-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-467"><a href="#cb42-467" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-468"><a href="#cb42-468" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb42-469"><a href="#cb42-469" aria-hidden="true" tabindex="-1"></a>b_1 \in <span class="co">[</span><span class="ot">50,75</span><span class="co">]</span>, b_2 \in <span class="co">[</span><span class="ot">100,300</span><span class="co">]</span>, b_3 \in <span class="co">[</span><span class="ot">0,25</span><span class="co">]</span>, b_4 \in <span class="co">[</span><span class="ot">0,30</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-470"><a href="#cb42-470" aria-hidden="true" tabindex="-1"></a>\mu_{EI} = 0.1, \mu_{IR} = 0.1 <span class="sc">\\</span></span>
<span id="cb42-471"><a href="#cb42-471" aria-hidden="true" tabindex="-1"></a>\rho \in <span class="co">[</span><span class="ot">0.0,0.3</span><span class="co">]</span>, \eta \in <span class="co">[</span><span class="ot">0.0,0.3</span><span class="co">]</span>, \tau \in <span class="co">[</span><span class="ot">0,0.06</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb42-472"><a href="#cb42-472" aria-hidden="true" tabindex="-1"></a>N = 126,226,568 <span class="sc">\\</span></span>
<span id="cb42-473"><a href="#cb42-473" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb42-474"><a href="#cb42-474" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-475"><a href="#cb42-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-476"><a href="#cb42-476" aria-hidden="true" tabindex="-1"></a><span class="fu">## Global Search</span></span>
<span id="cb42-477"><a href="#cb42-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-478"><a href="#cb42-478" aria-hidden="true" tabindex="-1"></a><span class="fu">### Based on Local Search</span></span>
<span id="cb42-479"><a href="#cb42-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-480"><a href="#cb42-480" aria-hidden="true" tabindex="-1"></a>Based on the result of local search, we will perform a global search from multiple starting points, using a multi-stage iterative filtering process. Compared to normal iterative filtering process, the iteration time is longer and the disturbance amplitude is lower. We randomly draw 500 sets of starting values from the parameters that around the major trend in the trace plots in local research part that we mentioned above.</span>
<span id="cb42-481"><a href="#cb42-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-484"><a href="#cb42-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-485"><a href="#cb42-485" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb42-486"><a href="#cb42-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-487"><a href="#cb42-487" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2062379496</span>)</span>
<span id="cb42-488"><a href="#cb42-488" aria-hidden="true" tabindex="-1"></a>guesses <span class="ot">=</span> <span class="fu">runif_design</span>(</span>
<span id="cb42-489"><a href="#cb42-489" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">50</span>, <span class="at">b2 =</span> <span class="dv">100</span>, <span class="at">b3 =</span> <span class="dv">0</span>, <span class="at">b4 =</span> <span class="dv">0</span>, </span>
<span id="cb42-490"><a href="#cb42-490" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">eta =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="dv">0</span>),</span>
<span id="cb42-491"><a href="#cb42-491" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">75</span>, <span class="at">b2 =</span> <span class="dv">300</span>, <span class="at">b3 =</span> <span class="dv">25</span>, <span class="at">b4 =</span> <span class="dv">30</span>, </span>
<span id="cb42-492"><a href="#cb42-492" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">eta =</span> <span class="fl">0.3</span>, <span class="at">tau =</span> <span class="fl">0.006</span>),</span>
<span id="cb42-493"><a href="#cb42-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">nseq =</span> <span class="dv">500</span></span>
<span id="cb42-494"><a href="#cb42-494" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-495"><a href="#cb42-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-496"><a href="#cb42-496" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]]</span>
<span id="cb42-497"><a href="#cb42-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-498"><a href="#cb42-498" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_1.rds"</span>,{</span>
<span id="cb42-499"><a href="#cb42-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoRNG</span>(<span class="dv">1270401374</span>)</span>
<span id="cb42-500"><a href="#cb42-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess=</span><span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb42-501"><a href="#cb42-501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-502"><a href="#cb42-502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-503"><a href="#cb42-503" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-504"><a href="#cb42-504" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-505"><a href="#cb42-505" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span> <span class="co"># cooling.fraction.50 = 0.5</span></span>
<span id="cb42-506"><a href="#cb42-506" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">Nmif =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-507"><a href="#cb42-507" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-508"><a href="#cb42-508" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>)</span>
<span id="cb42-509"><a href="#cb42-509" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf <span class="sc">%&gt;%</span></span>
<span id="cb42-510"><a href="#cb42-510" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-511"><a href="#cb42-511" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-512"><a href="#cb42-512" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-513"><a href="#cb42-513" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> <span class="dv">2</span>, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb42-514"><a href="#cb42-514" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(<span class="dv">20</span>, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb42-515"><a href="#cb42-515" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-516"><a href="#cb42-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-517"><a href="#cb42-517" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb42-518"><a href="#cb42-518" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb42-519"><a href="#cb42-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-520"><a href="#cb42-520" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb42-521"><a href="#cb42-521" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb42-522"><a href="#cb42-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="ot">-&gt;</span> results</span>
<span id="cb42-523"><a href="#cb42-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-524"><a href="#cb42-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-525"><a href="#cb42-525" aria-hidden="true" tabindex="-1"></a>The result table below of global search displays six groups of estimates with the maximum likelihood values. Some of the estimated parameters and likelihood are stable, and the maximum likelihood estimate (MLE) obtained a log likelihood of -3531.871 and a standard error of 0.264, which is an improvement from our initial guess.</span>
<span id="cb42-526"><a href="#cb42-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-529"><a href="#cb42-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-530"><a href="#cb42-530" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span></span>
<span id="cb42-531"><a href="#cb42-531" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Global search results with the Best Likelihood Value"</span>)</span>
<span id="cb42-532"><a href="#cb42-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-533"><a href="#cb42-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-534"><a href="#cb42-534" aria-hidden="true" tabindex="-1"></a>However, the simulations with the MLE are not as good as we expected. The reasons might be that the new cases number is too high. And log scale may be needed to normalized the log-likelihood. That’s why we see the better log-likelihood from this plot.</span>
<span id="cb42-535"><a href="#cb42-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-538"><a href="#cb42-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-539"><a href="#cb42-539" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb42-540"><a href="#cb42-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb42-541"><a href="#cb42-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="ot">-&gt;</span> best_global_results</span>
<span id="cb42-542"><a href="#cb42-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-543"><a href="#cb42-543" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">531</span>)</span>
<span id="cb42-544"><a href="#cb42-544" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb42-545"><a href="#cb42-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(</span>
<span id="cb42-546"><a href="#cb42-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">params=</span><span class="fu">unlist</span>(best_global_results[<span class="dv">1</span>,]),</span>
<span id="cb42-547"><a href="#cb42-547" aria-hidden="true" tabindex="-1"></a>    <span class="at">nsim=</span><span class="dv">10</span>,<span class="at">format=</span><span class="st">"data.frame"</span>,<span class="at">include.data=</span><span class="cn">TRUE</span></span>
<span id="cb42-548"><a href="#cb42-548" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> sims</span>
<span id="cb42-549"><a href="#cb42-549" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span></span>
<span id="cb42-550"><a href="#cb42-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>new_cases,<span class="at">group=</span>.id,<span class="at">color=</span>.id<span class="sc">==</span><span class="st">"data"</span>))<span class="sc">+</span></span>
<span id="cb42-551"><a href="#cb42-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb42-552"><a href="#cb42-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Simulation for Data with the Best Global Parameters Searching"</span>)</span>
<span id="cb42-553"><a href="#cb42-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-554"><a href="#cb42-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-555"><a href="#cb42-555" aria-hidden="true" tabindex="-1"></a>The pairs plot and simulation plot for the global search are as below.</span>
<span id="cb42-556"><a href="#cb42-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-559"><a href="#cb42-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-560"><a href="#cb42-560" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb42-561"><a href="#cb42-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb42-562"><a href="#cb42-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="ot">-&gt;</span> tmp</span>
<span id="cb42-563"><a href="#cb42-563" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb42-564"><a href="#cb42-564" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> mu_EI <span class="sc">+</span> mu_IR <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> results, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb42-565"><a href="#cb42-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-566"><a href="#cb42-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-567"><a href="#cb42-567" aria-hidden="true" tabindex="-1"></a>Our local guessing and global search return distinct simulation curves, with the local search providing a more accurate estimate. Global search simulation appears to not align well with the data in terms of estimating the extent and time of the peak, but it is better at simulating the data behavior at early time.</span>
<span id="cb42-568"><a href="#cb42-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-569"><a href="#cb42-569" aria-hidden="true" tabindex="-1"></a>Taking the accuracy of the initial guessing, next, we will perform a global search around the initial guessing. We set the range around the initial parameters to see the results of global search, which are $b_1 \in <span class="co">[</span><span class="ot">0,5</span><span class="co">]</span>, b_2 \in <span class="co">[</span><span class="ot">5,15</span><span class="co">]</span>, b_3 \in <span class="co">[</span><span class="ot">10,30</span><span class="co">]</span>, b_4 \in <span class="co">[</span><span class="ot">10,30</span><span class="co">]</span>, \rho \in <span class="co">[</span><span class="ot">0.2,0.6</span><span class="co">]</span>, \eta \in <span class="co">[</span><span class="ot">0,0.2</span><span class="co">]</span>$ and $\tau \in <span class="co">[</span><span class="ot">0, 0.01</span><span class="co">]</span>$.</span>
<span id="cb42-570"><a href="#cb42-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-571"><a href="#cb42-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-574"><a href="#cb42-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-575"><a href="#cb42-575" aria-hidden="true" tabindex="-1"></a>covid_box <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb42-576"><a href="#cb42-576" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),</span>
<span id="cb42-577"><a href="#cb42-577" aria-hidden="true" tabindex="-1"></a>  <span class="at">b2 =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">15</span>),</span>
<span id="cb42-578"><a href="#cb42-578" aria-hidden="true" tabindex="-1"></a>  <span class="at">b3 =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>),</span>
<span id="cb42-579"><a href="#cb42-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">b4 =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>),</span>
<span id="cb42-580"><a href="#cb42-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_EI =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb42-581"><a href="#cb42-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_IR =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb42-582"><a href="#cb42-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>),</span>
<span id="cb42-583"><a href="#cb42-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb42-584"><a href="#cb42-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>),</span>
<span id="cb42-585"><a href="#cb42-585" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">126226568</span>,<span class="dv">126226568</span>)</span>
<span id="cb42-586"><a href="#cb42-586" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-587"><a href="#cb42-587" aria-hidden="true" tabindex="-1"></a>cooling.fraction<span class="fl">.50</span> <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-588"><a href="#cb42-588" aria-hidden="true" tabindex="-1"></a>params_rw.sd <span class="ot">&lt;-</span> <span class="fu">rw_sd</span>(</span>
<span id="cb42-589"><a href="#cb42-589" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fl">0.0001</span>, <span class="at">b2 =</span> <span class="fl">0.0001</span>, <span class="at">b3 =</span> <span class="fl">0.0005</span>, <span class="at">b4 =</span> <span class="fl">0.0005</span>,</span>
<span id="cb42-590"><a href="#cb42-590" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fl">0.0005</span>, <span class="at">eta =</span> <span class="fl">0.0001</span>, <span class="at">tau =</span> <span class="fl">0.00001</span></span>
<span id="cb42-591"><a href="#cb42-591" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-592"><a href="#cb42-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-593"><a href="#cb42-593" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"mifs_global.rds"</span>, {</span>
<span id="cb42-594"><a href="#cb42-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb42-595"><a href="#cb42-595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-596"><a href="#cb42-596" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-597"><a href="#cb42-597" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-598"><a href="#cb42-598" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-599"><a href="#cb42-599" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mif2</span>(</span>
<span id="cb42-600"><a href="#cb42-600" aria-hidden="true" tabindex="-1"></a>      covidSEIR,</span>
<span id="cb42-601"><a href="#cb42-601" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> <span class="fu">c</span>(<span class="fu">apply</span>(covid_box, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">1</span>, x[<span class="dv">1</span>], x[<span class="dv">2</span>]))),</span>
<span id="cb42-602"><a href="#cb42-602" aria-hidden="true" tabindex="-1"></a>      <span class="at">Np =</span> <span class="dv">5000</span>, <span class="at">Nmif =</span> <span class="dv">50</span>,</span>
<span id="cb42-603"><a href="#cb42-603" aria-hidden="true" tabindex="-1"></a>      <span class="at">cooling.fraction.50 =</span> cooling.fraction<span class="fl">.50</span>,</span>
<span id="cb42-604"><a href="#cb42-604" aria-hidden="true" tabindex="-1"></a>      <span class="at">rw.sd =</span> params_rw.sd</span>
<span id="cb42-605"><a href="#cb42-605" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-606"><a href="#cb42-606" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> mifs_global</span>
<span id="cb42-607"><a href="#cb42-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(mifs_global, <span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-608"><a href="#cb42-608" aria-hidden="true" tabindex="-1"></a>  mifs_global</span>
<span id="cb42-609"><a href="#cb42-609" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> mifs_global</span>
<span id="cb42-610"><a href="#cb42-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-611"><a href="#cb42-611" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_results.rds"</span>, {</span>
<span id="cb42-612"><a href="#cb42-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">mf =</span> mifs_global, <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb42-613"><a href="#cb42-613" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-614"><a href="#cb42-614" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-615"><a href="#cb42-615" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-616"><a href="#cb42-616" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-617"><a href="#cb42-617" aria-hidden="true" tabindex="-1"></a>    evals <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">20</span>, <span class="fu">logLik</span>(<span class="fu">pfilter</span>(mf, <span class="at">Np =</span> <span class="dv">10000</span>)))</span>
<span id="cb42-618"><a href="#cb42-618" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">&lt;-</span> <span class="fu">logmeanexp</span>(evals, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-619"><a href="#cb42-619" aria-hidden="true" tabindex="-1"></a>    mf <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-620"><a href="#cb42-620" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>], <span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb42-621"><a href="#cb42-621" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> global_results</span>
<span id="cb42-622"><a href="#cb42-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(global_results, <span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-623"><a href="#cb42-623" aria-hidden="true" tabindex="-1"></a>  global_results</span>
<span id="cb42-624"><a href="#cb42-624" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> global_results</span>
<span id="cb42-625"><a href="#cb42-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-626"><a href="#cb42-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-627"><a href="#cb42-627" aria-hidden="true" tabindex="-1"></a>The best global search had the following simulated parameters and log likelihood:</span>
<span id="cb42-628"><a href="#cb42-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-631"><a href="#cb42-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-632"><a href="#cb42-632" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(global_results) <span class="sc">%&gt;%</span></span>
<span id="cb42-633"><a href="#cb42-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb42-634"><a href="#cb42-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="ot">-&gt;</span> best_global_results</span>
<span id="cb42-635"><a href="#cb42-635" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(best_global_results),<span class="dv">5</span>)</span>
<span id="cb42-636"><a href="#cb42-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-637"><a href="#cb42-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-638"><a href="#cb42-638" aria-hidden="true" tabindex="-1"></a>The best global search has a likelihood of  -4457.772 and a standard error of 0.257, which is not significantly better than the log likelihood of the previous local and global search. The pairs plot and simulation plot for the global search are as below.</span>
<span id="cb42-639"><a href="#cb42-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-642"><a href="#cb42-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-643"><a href="#cb42-643" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(global_results) <span class="sc">%&gt;%</span> </span>
<span id="cb42-644"><a href="#cb42-644" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(results) <span class="sc">%&gt;%</span></span>
<span id="cb42-645"><a href="#cb42-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb42-646"><a href="#cb42-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik.se <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="ot">-&gt;</span> tmp</span>
<span id="cb42-647"><a href="#cb42-647" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">+</span> b3 <span class="sc">+</span> b4, <span class="at">data =</span> global_results, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb42-648"><a href="#cb42-648" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik <span class="sc">+</span> mu_EI <span class="sc">+</span> mu_IR <span class="sc">+</span> eta <span class="sc">+</span> rho <span class="sc">+</span> tau, <span class="at">data =</span> global_results, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb42-649"><a href="#cb42-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-652"><a href="#cb42-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-653"><a href="#cb42-653" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">531</span>)</span>
<span id="cb42-654"><a href="#cb42-654" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb42-655"><a href="#cb42-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(</span>
<span id="cb42-656"><a href="#cb42-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">params=</span><span class="fu">unlist</span>(best_global_results[<span class="dv">1</span>,]),</span>
<span id="cb42-657"><a href="#cb42-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">nsim=</span><span class="dv">10</span>,<span class="at">format=</span><span class="st">"data.frame"</span>,<span class="at">include.data=</span><span class="cn">TRUE</span></span>
<span id="cb42-658"><a href="#cb42-658" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> sims</span>
<span id="cb42-659"><a href="#cb42-659" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span></span>
<span id="cb42-660"><a href="#cb42-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>new_cases,<span class="at">group=</span>.id,<span class="at">color=</span>.id<span class="sc">==</span><span class="st">"data"</span>))<span class="sc">+</span></span>
<span id="cb42-661"><a href="#cb42-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb42-662"><a href="#cb42-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Simulation for data with global parameters searching"</span>)</span>
<span id="cb42-663"><a href="#cb42-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-664"><a href="#cb42-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-665"><a href="#cb42-665" aria-hidden="true" tabindex="-1"></a>Although the simulation plot is more reasonable fit for our data, it still appears to miss the peak of cases, in timing and extent. Taking the log likelihood into consideration, the results of previous global search is better.</span>
<span id="cb42-666"><a href="#cb42-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-667"><a href="#cb42-667" aria-hidden="true" tabindex="-1"></a><span class="fu">### Not Based on Local Search</span></span>
<span id="cb42-668"><a href="#cb42-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-669"><a href="#cb42-669" aria-hidden="true" tabindex="-1"></a>Next, we will explore on the parameter settings without using the result from local search, especially the $\tau$ parameter that we will increase the range of parameter value as the following:</span>
<span id="cb42-670"><a href="#cb42-670" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-671"><a href="#cb42-671" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb42-672"><a href="#cb42-672" aria-hidden="true" tabindex="-1"></a>b_1, b_2, b_3, b_4 \in <span class="co">[</span><span class="ot">0,30</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-673"><a href="#cb42-673" aria-hidden="true" tabindex="-1"></a>\mu_{EI} = 0.1, \mu_{IR} = 0.1 <span class="sc">\\</span></span>
<span id="cb42-674"><a href="#cb42-674" aria-hidden="true" tabindex="-1"></a>\rho \in <span class="co">[</span><span class="ot">0.0,0.1</span><span class="co">]</span>, \eta \in <span class="co">[</span><span class="ot">0.0,0.3</span><span class="co">]</span>, \tau \in <span class="co">[</span><span class="ot">0,0.2</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb42-675"><a href="#cb42-675" aria-hidden="true" tabindex="-1"></a>N = 126,226,568 <span class="sc">\\</span></span>
<span id="cb42-676"><a href="#cb42-676" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb42-677"><a href="#cb42-677" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb42-678"><a href="#cb42-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-679"><a href="#cb42-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE}</span></span>
<span id="cb42-680"><a href="#cb42-680" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb42-681"><a href="#cb42-681" aria-hidden="true" tabindex="-1"></a>NSTART <span class="ot">=</span> <span class="dv">100</span> <span class="co"># 200</span></span>
<span id="cb42-682"><a href="#cb42-682" aria-hidden="true" tabindex="-1"></a>NMIF_L <span class="ot">=</span> <span class="dv">50</span><span class="co"># 100</span></span>
<span id="cb42-683"><a href="#cb42-683" aria-hidden="true" tabindex="-1"></a>NREPS_EVAL <span class="ot">=</span> <span class="dv">10</span> <span class="co"># 20</span></span>
<span id="cb42-684"><a href="#cb42-684" aria-hidden="true" tabindex="-1"></a>NP <span class="ot">=</span> <span class="dv">1000</span> <span class="co"># 1500</span></span>
<span id="cb42-685"><a href="#cb42-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-686"><a href="#cb42-686" aria-hidden="true" tabindex="-1"></a><span class="co"># create a box of starting values (for parameters)</span></span>
<span id="cb42-687"><a href="#cb42-687" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2062379496</span>)</span>
<span id="cb42-688"><a href="#cb42-688" aria-hidden="true" tabindex="-1"></a>guesses <span class="ot">=</span> <span class="fu">runif_design</span>(</span>
<span id="cb42-689"><a href="#cb42-689" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">0</span>, <span class="at">b2 =</span> <span class="dv">0</span>, <span class="at">b3 =</span> <span class="dv">0</span>, <span class="at">b4 =</span> <span class="dv">0</span>,</span>
<span id="cb42-690"><a href="#cb42-690" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">eta =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="dv">0</span>),</span>
<span id="cb42-691"><a href="#cb42-691" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">30</span>, <span class="at">b2 =</span> <span class="dv">30</span>, <span class="at">b3 =</span> <span class="dv">30</span>, <span class="at">b4 =</span> <span class="dv">30</span>,</span>
<span id="cb42-692"><a href="#cb42-692" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho =</span> <span class="dv">1</span>, <span class="at">eta =</span> <span class="fl">0.3</span>, <span class="at">tau =</span> <span class="fl">0.2</span>),</span>
<span id="cb42-693"><a href="#cb42-693" aria-hidden="true" tabindex="-1"></a>  <span class="at">nseq =</span> NSTART</span>
<span id="cb42-694"><a href="#cb42-694" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-695"><a href="#cb42-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-696"><a href="#cb42-696" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]] <span class="co"># take the output of previous IF process (local search)</span></span>
<span id="cb42-697"><a href="#cb42-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-698"><a href="#cb42-698" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_search_2.rds"</span>,{</span>
<span id="cb42-699"><a href="#cb42-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoRNG</span>(<span class="dv">1270401374</span>)</span>
<span id="cb42-700"><a href="#cb42-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess=</span><span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb42-701"><a href="#cb42-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-702"><a href="#cb42-702" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-703"><a href="#cb42-703" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-704"><a href="#cb42-704" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-705"><a href="#cb42-705" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span> <span class="co"># cooling.fraction.50 = 0.5</span></span>
<span id="cb42-706"><a href="#cb42-706" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">Nmif =</span> NMIF_L) <span class="sc">%&gt;%</span></span>
<span id="cb42-707"><a href="#cb42-707" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L) <span class="sc">%&gt;%</span></span>
<span id="cb42-708"><a href="#cb42-708" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L)</span>
<span id="cb42-709"><a href="#cb42-709" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf <span class="sc">%&gt;%</span></span>
<span id="cb42-710"><a href="#cb42-710" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-711"><a href="#cb42-711" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-712"><a href="#cb42-712" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-713"><a href="#cb42-713" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb42-714"><a href="#cb42-714" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(NREPS_EVAL, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> NP) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb42-715"><a href="#cb42-715" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-716"><a href="#cb42-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-717"><a href="#cb42-717" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb42-718"><a href="#cb42-718" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb42-719"><a href="#cb42-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results,<span class="st">"ncpu"</span>) <span class="ot">&lt;-</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-720"><a href="#cb42-720" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb42-721"><a href="#cb42-721" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb42-722"><a href="#cb42-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="ot">-&gt;</span> results</span>
<span id="cb42-723"><a href="#cb42-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-724"><a href="#cb42-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-727"><a href="#cb42-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-728"><a href="#cb42-728" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>loglik) <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> </span>
<span id="cb42-729"><a href="#cb42-729" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Global search results (in decreasing order of likelihood)"</span>)</span>
<span id="cb42-730"><a href="#cb42-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-731"><a href="#cb42-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-732"><a href="#cb42-732" aria-hidden="true" tabindex="-1"></a>Then we tried different setting among the best global searching results:</span>
<span id="cb42-733"><a href="#cb42-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-736"><a href="#cb42-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-737"><a href="#cb42-737" aria-hidden="true" tabindex="-1"></a>covidSEIR <span class="sc">%&gt;%</span></span>
<span id="cb42-738"><a href="#cb42-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">60</span>, <span class="at">b2 =</span> <span class="fl">0.06</span>, <span class="at">b3 =</span> <span class="dv">40</span>, <span class="at">b4 =</span> <span class="dv">600</span>, </span>
<span id="cb42-739"><a href="#cb42-739" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu_EI =</span> <span class="fl">0.1</span>, <span class="at">mu_IR =</span> <span class="fl">0.1</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">eta =</span> <span class="fl">0.05</span>, </span>
<span id="cb42-740"><a href="#cb42-740" aria-hidden="true" tabindex="-1"></a>            <span class="at">tau =</span> <span class="fl">0.3</span>, <span class="at">N =</span> <span class="dv">126226568</span>), <span class="at">nsim =</span> <span class="dv">30</span>, <span class="at">format =</span> <span class="st">"data.frame"</span>, <span class="at">include.data =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-741"><a href="#cb42-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_simulation</span>()</span>
<span id="cb42-742"><a href="#cb42-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-743"><a href="#cb42-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-744"><a href="#cb42-744" aria-hidden="true" tabindex="-1"></a>The simulations conducted using MLE among global search results demonstrate clear improvements over initial starting points. They effectively capture the peaks and turning points of the epidemic, with the exception of the onset of the first outbreak. Furthermore, they offer a reasonable explanation for the spread of the virus under specific conditions.</span>
<span id="cb42-745"><a href="#cb42-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-746"><a href="#cb42-746" aria-hidden="true" tabindex="-1"></a>We then proceed to examine the likelihood surface of the parameters.</span>
<span id="cb42-747"><a href="#cb42-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-750"><a href="#cb42-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-751"><a href="#cb42-751" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span></span>
<span id="cb42-752"><a href="#cb42-752" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(guesses) <span class="sc">|&gt;</span></span>
<span id="cb42-753"><a href="#cb42-753" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(loglik),<span class="st">"guess"</span>,<span class="st">"result"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-754"><a href="#cb42-754" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(type) <span class="ot">-&gt;</span> all</span>
<span id="cb42-755"><a href="#cb42-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-756"><a href="#cb42-756" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>b1<span class="sc">+</span>b2<span class="sc">+</span>b3<span class="sc">+</span>b4, <span class="at">data=</span>all, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>,</span>
<span id="cb42-757"><a href="#cb42-757" aria-hidden="true" tabindex="-1"></a><span class="at">col=</span><span class="fu">ifelse</span>(all<span class="sc">$</span>type<span class="sc">==</span><span class="st">"guess"</span>,<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span>
<span id="cb42-758"><a href="#cb42-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-759"><a href="#cb42-759" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>rho<span class="sc">+</span>eta<span class="sc">+</span>tau, <span class="at">data=</span>all, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>,</span>
<span id="cb42-760"><a href="#cb42-760" aria-hidden="true" tabindex="-1"></a><span class="at">col=</span><span class="fu">ifelse</span>(all<span class="sc">$</span>type<span class="sc">==</span><span class="st">"guess"</span>,<span class="st">"aquamarine3"</span>,<span class="st">"coral1"</span>))</span>
<span id="cb42-761"><a href="#cb42-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-762"><a href="#cb42-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-763"><a href="#cb42-763" aria-hidden="true" tabindex="-1"></a>In the scatter plot matrix, the initial starting points are depicted in grey, while the iterated filtering estimates are highlighted in red. Notably, parameters such as $N, \mu_{EI}$ and $\mu_{IR}$ remain fixed and are therefore excluded from the visual representation. For the remaining parameters, we observe that the global search commences from diverse starting points and converges towards specific regions within the parameter space. However, the initial scatter plots reveal a sub-optimal selection of initial values for b1 to b4, as evidenced by the insufficient decentralization of the grey points. Despite this, we are afforded a comprehensive view of the likelihood surfaces for all parameters. Remarkably, the ranges of parameters compatible with the data within our current model setting exhibit narrow variability. This heightened precision instills greater confidence in our maximum likelihood estimates.</span>
<span id="cb42-764"><a href="#cb42-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-765"><a href="#cb42-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Profile likelihood on $\rho$</span></span>
<span id="cb42-766"><a href="#cb42-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-767"><a href="#cb42-767" aria-hidden="true" tabindex="-1"></a>The plot of the profile design are shown below:</span>
<span id="cb42-768"><a href="#cb42-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-771"><a href="#cb42-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-772"><a href="#cb42-772" aria-hidden="true" tabindex="-1"></a><span class="co"># define the box</span></span>
<span id="cb42-773"><a href="#cb42-773" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span></span>
<span id="cb42-774"><a href="#cb42-774" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(range) <span class="ot">-&gt;</span> box</span>
<span id="cb42-775"><a href="#cb42-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-776"><a href="#cb42-776" aria-hidden="true" tabindex="-1"></a><span class="co"># show the profile design</span></span>
<span id="cb42-777"><a href="#cb42-777" aria-hidden="true" tabindex="-1"></a><span class="fu">freeze</span>(<span class="at">seed=</span><span class="dv">1196696958</span>,</span>
<span id="cb42-778"><a href="#cb42-778" aria-hidden="true" tabindex="-1"></a><span class="fu">profile_design</span>(</span>
<span id="cb42-779"><a href="#cb42-779" aria-hidden="true" tabindex="-1"></a><span class="at">rho=</span><span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.95</span>,<span class="at">length=</span><span class="dv">40</span>),</span>
<span id="cb42-780"><a href="#cb42-780" aria-hidden="true" tabindex="-1"></a><span class="at">lower=</span>box[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"b3"</span>,<span class="st">"b4"</span>,<span class="st">"eta"</span>,<span class="st">"tau"</span>)],</span>
<span id="cb42-781"><a href="#cb42-781" aria-hidden="true" tabindex="-1"></a><span class="at">upper=</span>box[<span class="dv">2</span>,<span class="fu">c</span>(<span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"b3"</span>,<span class="st">"b4"</span>,<span class="st">"eta"</span>,<span class="st">"tau"</span>)],</span>
<span id="cb42-782"><a href="#cb42-782" aria-hidden="true" tabindex="-1"></a><span class="at">nprof=</span><span class="dv">5</span>, <span class="at">type=</span><span class="st">"runif"</span></span>
<span id="cb42-783"><a href="#cb42-783" aria-hidden="true" tabindex="-1"></a>)) <span class="ot">-&gt;</span> guesses</span>
<span id="cb42-784"><a href="#cb42-784" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(guesses)</span>
<span id="cb42-785"><a href="#cb42-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-786"><a href="#cb42-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-787"><a href="#cb42-787" aria-hidden="true" tabindex="-1"></a>Based on it, we visualize the profile likelihood.</span>
<span id="cb42-788"><a href="#cb42-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-791"><a href="#cb42-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-792"><a href="#cb42-792" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb42-793"><a href="#cb42-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-794"><a href="#cb42-794" aria-hidden="true" tabindex="-1"></a>run_id <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb42-795"><a href="#cb42-795" aria-hidden="true" tabindex="-1"></a>rw_sd_rho_fixed <span class="ot">=</span> <span class="fu">rw_sd</span>(</span>
<span id="cb42-796"><a href="#cb42-796" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.02</span>, <span class="at">b3 =</span> <span class="fl">0.02</span>, <span class="at">b4 =</span> <span class="fl">0.02</span>,</span>
<span id="cb42-797"><a href="#cb42-797" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="dv">0</span>, <span class="at">tau =</span> <span class="fl">0.0001</span>, <span class="at">eta =</span> <span class="fu">ivp</span>(<span class="fl">0.02</span>)</span>
<span id="cb42-798"><a href="#cb42-798" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-799"><a href="#cb42-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-800"><a href="#cb42-800" aria-hidden="true" tabindex="-1"></a>mf1 <span class="ot">=</span> mifs_local[[<span class="dv">1</span>]]</span>
<span id="cb42-801"><a href="#cb42-801" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>(<span class="dv">2105684752</span>)</span>
<span id="cb42-802"><a href="#cb42-802" aria-hidden="true" tabindex="-1"></a><span class="fu">bake</span>(<span class="at">file =</span> <span class="st">"global_profile.rds"</span>, {</span>
<span id="cb42-803"><a href="#cb42-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">guess =</span> <span class="fu">iter</span>(guesses, <span class="st">"row"</span>), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb42-804"><a href="#cb42-804" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb42-805"><a href="#cb42-805" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(tidyverse)</span>
<span id="cb42-806"><a href="#cb42-806" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pomp)</span>
<span id="cb42-807"><a href="#cb42-807" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-808"><a href="#cb42-808" aria-hidden="true" tabindex="-1"></a>    mf <span class="ot">=</span> mf1 <span class="sc">%&gt;%</span></span>
<span id="cb42-809"><a href="#cb42-809" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">params =</span> <span class="fu">c</span>(<span class="fu">unlist</span>(guess), fixed_params), <span class="at">rw.sd =</span> rw_sd_rho_fixed) <span class="sc">%&gt;%</span> </span>
<span id="cb42-810"><a href="#cb42-810" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">Nmif =</span> NMIF_L, <span class="at">cooling.fraction.50 =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-811"><a href="#cb42-811" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mif2</span>(<span class="at">cooling.fraction.50 =</span> <span class="fl">0.1</span>)</span>
<span id="cb42-812"><a href="#cb42-812" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">replicate</span>(NREPS_EVAL, mf <span class="sc">%&gt;%</span> <span class="fu">pfilter</span>(<span class="at">Np =</span> NP) <span class="sc">%&gt;%</span> <span class="fu">logLik</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb42-813"><a href="#cb42-813" aria-hidden="true" tabindex="-1"></a>      <span class="fu">logmeanexp</span>(<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-814"><a href="#cb42-814" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(mf) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="at">loglik =</span> ll[<span class="dv">1</span>],<span class="at">loglik.se =</span> ll[<span class="dv">2</span>])</span>
<span id="cb42-815"><a href="#cb42-815" aria-hidden="true" tabindex="-1"></a>  } <span class="ot">-&gt;</span> results</span>
<span id="cb42-816"><a href="#cb42-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(results, <span class="st">"ncpu"</span>) <span class="ot">=</span> <span class="fu">getDoParWorkers</span>()</span>
<span id="cb42-817"><a href="#cb42-817" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb42-818"><a href="#cb42-818" aria-hidden="true" tabindex="-1"></a>}) <span class="ot">-&gt;</span> results_profile</span>
<span id="cb42-819"><a href="#cb42-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-820"><a href="#cb42-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-823"><a href="#cb42-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-824"><a href="#cb42-824" aria-hidden="true" tabindex="-1"></a>results_profile <span class="sc">|&gt;</span></span>
<span id="cb42-825"><a href="#cb42-825" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(loglik<span class="sc">&gt;</span><span class="fu">max</span>(loglik)<span class="sc">-</span><span class="dv">50</span>) <span class="ot">-&gt;</span> all</span>
<span id="cb42-826"><a href="#cb42-826" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>loglik<span class="sc">+</span>b1<span class="sc">+</span>b2<span class="sc">+</span>b3<span class="sc">+</span>b4<span class="sc">+</span>eta<span class="sc">+</span>tau<span class="sc">+</span>rho,<span class="at">data=</span>all,<span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb42-827"><a href="#cb42-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-828"><a href="#cb42-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-829"><a href="#cb42-829" aria-hidden="true" tabindex="-1"></a>From the profile likelihood have very decentralized distribution, especially for $\eta, \tau$ and $\rho$.</span>
<span id="cb42-830"><a href="#cb42-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-831"><a href="#cb42-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE}</span></span>
<span id="cb42-832"><a href="#cb42-832" aria-hidden="true" tabindex="-1"></a>maxloglik <span class="ot">&lt;-</span> <span class="fu">max</span>(results_profile<span class="sc">$</span>loglik,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-833"><a href="#cb42-833" aria-hidden="true" tabindex="-1"></a>ci.cutoff <span class="ot">&lt;-</span> maxloglik<span class="fl">-0.5</span><span class="sc">*</span><span class="fu">qchisq</span>(<span class="at">df=</span><span class="dv">1</span>,<span class="at">p=</span><span class="fl">0.95</span>)</span>
<span id="cb42-834"><a href="#cb42-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-835"><a href="#cb42-835" aria-hidden="true" tabindex="-1"></a>results_profile <span class="sc">|&gt;</span></span>
<span id="cb42-836"><a href="#cb42-836" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">|&gt;</span></span>
<span id="cb42-837"><a href="#cb42-837" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(<span class="fu">round</span>(rho,<span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-838"><a href="#cb42-838" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">rank</span>(<span class="sc">-</span>loglik)<span class="sc">&lt;</span><span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-839"><a href="#cb42-839" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-840"><a href="#cb42-840" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>rho,<span class="at">y=</span>loglik))<span class="sc">+</span></span>
<span id="cb42-841"><a href="#cb42-841" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb42-842"><a href="#cb42-842" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_smooth(method="loess",span=0.25)+</span></span>
<span id="cb42-843"><a href="#cb42-843" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">color=</span><span class="st">"coral1"</span>,<span class="at">yintercept=</span>ci.cutoff)<span class="sc">+</span></span>
<span id="cb42-844"><a href="#cb42-844" aria-hidden="true" tabindex="-1"></a><span class="fu">lims</span>(<span class="at">y=</span>maxloglik<span class="sc">-</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">0</span>))</span>
<span id="cb42-845"><a href="#cb42-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-846"><a href="#cb42-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-849"><a href="#cb42-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-850"><a href="#cb42-850" aria-hidden="true" tabindex="-1"></a>rho_ci <span class="ot">=</span> results_profile <span class="sc">%&gt;%</span></span>
<span id="cb42-851"><a href="#cb42-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(loglik)) <span class="sc">%&gt;%</span></span>
<span id="cb42-852"><a href="#cb42-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loglik <span class="sc">&gt;</span> <span class="fu">max</span>(loglik) <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">qchisq</span>(<span class="at">df =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.95</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-853"><a href="#cb42-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(rho), <span class="at">max =</span> <span class="fu">max</span>(rho))</span>
<span id="cb42-854"><a href="#cb42-854" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rho_ci)</span>
<span id="cb42-855"><a href="#cb42-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-856"><a href="#cb42-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-857"><a href="#cb42-857" aria-hidden="true" tabindex="-1"></a>The 95% confidence interval for $\rho$ spans from 66.07% to 92.58%, indicating a relatively wide range. This is partially attributed to the limited number of data points surpassing the threshold. Furthermore, in comparison to other epidemic diseases or COVID-19 scenarios in different regions, the findings suggest a notably high reporting rate. This observation may suggest stringent disease reporting and control measures implemented in Japan [<span class="co">[</span><span class="ot">18</span><span class="co">]</span>](https://kpmg.com/xx/en/home/insights/2021/12/flash-alert-2021-296.html).</span>
<span id="cb42-858"><a href="#cb42-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-859"><a href="#cb42-859" aria-hidden="true" tabindex="-1"></a><span class="fu"># Reference</span></span>
<span id="cb42-860"><a href="#cb42-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-861"><a href="#cb42-861" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1</span><span class="co">] [COVID-19 Dashboard by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University(JHU)]</span>(https://gisanddata.maps.arcgis.com/apps/dashboards/bda7594740fd40299423467b48e9ecf6).     </span>
<span id="cb42-862"><a href="#cb42-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-863"><a href="#cb42-863" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">2</span><span class="co">] [ARMA]</span>(https://en.wikipedia.org/wiki/Autoregressive_moving-average_model).   </span>
<span id="cb42-864"><a href="#cb42-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-865"><a href="#cb42-865" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">3</span><span class="co">] [SIR/SEIR]</span>(https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology).   </span>
<span id="cb42-866"><a href="#cb42-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-867"><a href="#cb42-867" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">4</span><span class="co">] [COVID-19 dataset]</span>(https://github.com/owid/covid-19-data/tree/master/public/data).   </span>
<span id="cb42-868"><a href="#cb42-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-869"><a href="#cb42-869" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">5</span><span class="co">] [World Health Organization Coronavirus Dashboard]</span>(https://data.who.int/dashboards/covid19/cases?n=c).  </span>
<span id="cb42-870"><a href="#cb42-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-871"><a href="#cb42-871" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">6</span><span class="co">] [ACF and PACF]</span>(https://ionides.github.io/531w24/02/slides.pdf).   </span>
<span id="cb42-872"><a href="#cb42-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-873"><a href="#cb42-873" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">7</span><span class="co">] [Spectrum Analysis]</span>(https://ionides.github.io/531w24/07/slides.pdf).    </span>
<span id="cb42-874"><a href="#cb42-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-875"><a href="#cb42-875" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">8</span><span class="co">] [Seasonality]</span>(https://ionides.github.io/531w24/06/slides.pdf).   </span>
<span id="cb42-876"><a href="#cb42-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-877"><a href="#cb42-877" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">9</span><span class="co">] [AIC table code]</span>(https://ionides.github.io/531w24/05/slides.pdf)</span>
<span id="cb42-878"><a href="#cb42-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-879"><a href="#cb42-879" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">10</span><span class="co">] [Project 15, STATS531W21]</span>(https://ionides.github.io/531w21/final_project/project15/blinded.html)</span>
<span id="cb42-880"><a href="#cb42-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-881"><a href="#cb42-881" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">11</span><span class="co">] [Chronology of major events related to coronavirus and Japan]</span>(https://english.kyodonews.net/news/2021/04/29b154a681ba-chronology-of-major-events-related-to-coronavirus-and-japan.html)</span>
<span id="cb42-882"><a href="#cb42-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-883"><a href="#cb42-883" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">12</span><span class="co">] [COVID-19 vaccination in Japan]</span>(https://en.wikipedia.org/wiki/COVID-19_vaccination_in_Japan)</span>
<span id="cb42-884"><a href="#cb42-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-885"><a href="#cb42-885" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">13</span><span class="co">] [COVID-19 in Japan during 2020-2022: Characteristics, responses, and implications for the health care system]</span>(https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9559364/)</span>
<span id="cb42-886"><a href="#cb42-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-887"><a href="#cb42-887" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">14</span><span class="co">] [First omicron variant in Japan]</span>(https://www.mhlw.go.jp/stf/newpage_22507.html)</span>
<span id="cb42-888"><a href="#cb42-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-889"><a href="#cb42-889" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">15</span><span class="co">] [Demographics of Japan]</span>(https://en.wikipedia.org/wiki/Demographics_of_Japan#:~:text=According%20to%20a%20demographic%20study,511%2C000%20people%20in%20one%20year.)</span>
<span id="cb42-890"><a href="#cb42-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-891"><a href="#cb42-891" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">16</span><span class="co">] [Incubation period for Covid-19]</span>(https://www.cdc.gov/coronavirus/2019-ncov/hcp/clinical-care/clinical-considerations-presentation.html#:~:text=Meta%2Danalyses%20of%20studies%20published,from%20exposure%20to%20symptom%20onset.)</span>
<span id="cb42-892"><a href="#cb42-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-893"><a href="#cb42-893" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">17</span><span class="co">] [Isolation and Precautions for People with COVID-19]</span>(https://archive.cdc.gov/#/details?archive_url=https://archive.cdc.gov/www_cdc_gov/coronavirus/2019-ncov/your-health/isolation.html)</span>
<span id="cb42-894"><a href="#cb42-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-895"><a href="#cb42-895" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">18</span><span class="co">] [Japan – COVID-19: Re-Shutting of Borders for One Month Due to Omicron Variant]</span>(https://kpmg.com/xx/en/home/insights/2021/12/flash-alert-2021-296.html)</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>